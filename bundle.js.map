{"version":3,"file":"bundle.js","sources":["node_modules/tslib/tslib.es6.js","node_modules/@bhmb/bot/es/player.js","node_modules/@bhmb/bot/es/updateLists.js","node_modules/blockheads-cloud-api/build_es.js","node_modules/@bhmb/ui/index.js","node_modules/@bhmb/messages/index.js","node_modules/@bhmb/console/index.js","src/extensions.ts","node_modules/@bhmb/bot/es/extension.js","node_modules/@bhmb/bot/es/events.js","node_modules/@bhmb/bot/es/chatWatcher.js","node_modules/@bhmb/bot/es/world.js","node_modules/@bhmb/bot/es/storage.js","node_modules/@bhmb/bot/es/index.js","src/bot.ts","src/storage.ts","src/settings.ts","src/index.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","function equalCaseInsensitive(a, b) {\n    return a.localeCompare(b, undefined, { sensitivity: 'base' }) === 0;\n}\nfunction arrayContainsAny(haystack, ...needles) {\n    return haystack.some(item => needles.some(needle => equalCaseInsensitive(item, needle)));\n}\n/**\n * Player class which is returned by the [[World.getPlayer]] method. Should not be created by any other method.\n */\nexport class Player {\n    /**\n     * Creates a new instance of the Player class.\n     *\n     * @param name The name of the player.\n     * @param info The player info stored between bot launches.\n     */\n    constructor(name, info, lists) {\n        this._name = name;\n        this._info = info;\n        this._lists = lists;\n    }\n    /**\n     * Gets the player's name.\n     */\n    get name() {\n        return this._name;\n    }\n    /**\n     * Gets the most recently used IP of the player.\n     */\n    get ip() {\n        return this._info.ip;\n    }\n    /**\n     * Gets the all IPs used by the player on the world.\n     */\n    get ips() {\n        return [...this._info.ips];\n    }\n    /**\n     * Gets the number of times the player has joined the server.\n     */\n    get joins() {\n        return this._info.joins;\n    }\n    /**\n     * Checks if the player has joined the server.\n     */\n    get hasJoined() {\n        return this.joins > 0;\n    }\n    /**\n     * Returns true if the player is the owner of the server or is the server.\n     */\n    get isOwner() {\n        return !!this._info.owner || this._name == 'SERVER';\n    }\n    /**\n     * Checks if the player is an admin or the owner.\n     */\n    get isAdmin() {\n        // A player is admin if their name or their latest IP is listed on the adminlist, or they are the owner.\n        return this.isOwner || arrayContainsAny(this._lists.adminlist, this._name, this._info.ip);\n    }\n    /**\n     * Checks if the player is a mod without admin permissions.\n     */\n    get isMod() {\n        // A player is mod if their name or their latest IP is on the modlist\n        return !this.isAdmin && arrayContainsAny(this._lists.modlist, this._name, this._info.ip);\n    }\n    /**\n     * Checks if the player is an admin or a mod.\n     */\n    get isStaff() {\n        return this.isAdmin || this.isMod;\n    }\n    /**\n     * Checks if the player is whitelisted. Is true if the player can join the server while it is whitelisted.\n     */\n    get isWhitelisted() {\n        // A player is whitelisted if they are staff or if their name or latest ip is on the whitelist.\n        return this.isStaff || arrayContainsAny(this._lists.whitelist, this._name, this._info.ip);\n    }\n    /**\n     * Checks if the player is banned.\n     */\n    get isBanned() {\n        return !this.isStaff && this._lists.blacklist\n            .some(entry => {\n            // We don't know the current player's device ID so can't check for that on the blacklist\n            // If the player's name is on the blacklist, they are banned.\n            // If an IP the player has used is banned, they are *probably* banned, so guess that they are.\n            // Remove device ID from blacklist entry, if there is one\n            if (entry.includes(' \\\\'))\n                entry = entry.substr(0, entry.indexOf(' \\\\'));\n            if (equalCaseInsensitive(this._name, entry))\n                return true;\n            if (this._info.ips.includes(entry))\n                return true;\n            return false;\n        });\n    }\n}\n//# sourceMappingURL=player.js.map","const addToList = (list, element) => !list.includes(element) && list.push(element);\nconst removeFromList = (list, element) => {\n    const index = list.indexOf(element);\n    if (index == -1)\n        return;\n    list.splice(index, 1);\n};\nconst removeFromLists = (lists, element) => lists.forEach(list => removeFromList(list, element));\nexport function updateLists(lists, player, message) {\n    if (!player.isAdmin)\n        return;\n    message = message.toLocaleUpperCase();\n    const target = message.replace(/^\\/\\w+? /, '');\n    if (message.startsWith('/ADMIN ')) {\n        addToList(lists.adminlist, target);\n        removeFromList(lists.blacklist, target);\n    }\n    else if (message.startsWith('/UNADMIN ')) {\n        removeFromList(lists.adminlist, target);\n    }\n    else if (message.startsWith('/MOD ')) {\n        addToList(lists.modlist, target);\n        removeFromList(lists.blacklist, target);\n    }\n    else if (message.startsWith('/UNMOD ')) {\n        removeFromList(lists.modlist, target);\n    }\n    else if (message.startsWith('/BAN ')) {\n        removeFromLists([lists.adminlist, lists.whitelist, lists.modlist], target);\n        addToList(lists.blacklist, target);\n    }\n    else if (message.startsWith('/UNBAN ')) {\n        removeFromList(lists.blacklist, target);\n    }\n    else if (message.startsWith('/WHITELIST ')) {\n        removeFromList(lists.blacklist, target);\n        addToList(lists.whitelist, target);\n    }\n    else if (message.startsWith('/UNWHITELIST ')) {\n        removeFromList(lists.whitelist, target);\n    }\n}\n//# sourceMappingURL=updateLists.js.map","import { createHash } from 'crypto';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\n\n/**\r\n * This module should not be used by consumers of this library.\r\n * @private\r\n */\r\n/**\r\n * Parses logs from the portal into a standard format. If you are consuming this library, you don't need to know anything about it.\r\n * @private\r\n */\r\nclass LogParser {\r\n    /**\r\n     * Creates a new instance of the LogParser class.\r\n     */\r\n    constructor() {\r\n        /**\r\n         * Parses the logs into a standard format.\r\n         *\r\n         * @param lines the raw log lines.\r\n         */\r\n        this.parse = (lines) => {\r\n            // Copy the lines array\r\n            lines = lines.slice(0);\r\n            // Assume first line is valid, if it isn't it will be dropped.\r\n            for (let i = lines.length - 1; i > 0; i--) {\r\n                const line = lines[i];\r\n                if (!this.isValidLine(line)) {\r\n                    lines[i - 1] += '\\n' + lines.splice(i, 1);\r\n                    continue;\r\n                }\r\n                this.addLine(line);\r\n            }\r\n            if (this.isValidLine(lines[0])) {\r\n                this.addLine(lines[0]);\r\n            }\r\n            const entries = this.entries.reverse();\r\n            this.entries = [];\r\n            return entries;\r\n        };\r\n        this.isValidLine = (line) => {\r\n            return /^\\d{4}-\\d\\d-\\d\\d \\d\\d:\\d\\d:\\d\\d\\.\\d{3} blockheads_server/.test(line);\r\n        };\r\n        this.addLine = (line) => {\r\n            const ts = line.substr(0, 24)\r\n                .replace(' ', 'T')\r\n                .replace(' ', 'Z');\r\n            this.entries.push({\r\n                raw: line,\r\n                timestamp: new Date(ts),\r\n                message: line.substr(line.indexOf(']') + 2)\r\n            });\r\n        };\r\n        this.entries = [];\r\n    }\r\n}\n\nfunction sha1(str) {\r\n    return createHash('sha1')\r\n        .update(str)\r\n        .digest('hex');\r\n}\r\nconst root = 'http://portal.theblockheads.net';\r\nlet request;\r\ntry {\r\n    request = fetch;\r\n}\r\ncatch (_) { }\r\n// Makes it possible to set the fetch function which the module uses. Necessary for terminal usage.\r\nfunction setFetch(fn) {\r\n    request = fn;\r\n}\r\nfunction unescapeHTML(html) {\r\n    const map = {\r\n        'lt': '<',\r\n        'gt': '>',\r\n        'amp': '&',\r\n        '#39': '\\'',\r\n        'quot': '\"',\r\n    };\r\n    return html.replace(/&(lt|gt|amp|#39|quot);/g, (_, first) => map[first]);\r\n}\r\nfunction makeRequest(url, options = {}) {\r\n    const headers = { 'X-Requested-With': 'XMLHttpRequest' };\r\n    if (options.method == 'POST') {\r\n        headers['Content-Type'] = 'application/x-www-form-urlencoded';\r\n    }\r\n    return request(`${root}${url}`, Object.assign({ mode: 'same-origin', credentials: 'same-origin', redirect: 'follow', \r\n        // Typescript incorrectly throws an error due to types here\r\n        headers: headers }, options));\r\n}\r\nfunction requestJSON(url, options) {\r\n    return makeRequest(url, options).then(r => r.json());\r\n}\r\nfunction requestPage(url, options) {\r\n    return makeRequest(url, options).then(r => r.text());\r\n}\r\n/**\r\n* Function to try to log in, if the log in fails, the returned promise will reject, otherwise it will resolve.\r\n*\r\n* @param username the username to try to log in with\r\n* @param password the password to try to log in with\r\n*/\r\nfunction login(username, password) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        username = username.toLocaleUpperCase();\r\n        const info = yield requestJSON('/login', {\r\n            method: 'POST',\r\n            body: `username=${encodeURIComponent(username)}`,\r\n        });\r\n        if (info.status != 'ok')\r\n            throw new Error('Bad API response.');\r\n        let hashedPass = sha1(info.salt + password);\r\n        hashedPass = sha1(hashedPass + info.salt2);\r\n        const body = `seed=${info.seed}&password=${hashedPass}&username=${encodeURIComponent(username)}`;\r\n        const page = yield requestPage('/login', { body, method: 'POST' });\r\n        if (page.includes('Invalid username / password')) {\r\n            throw new Error('Invalid username or password.');\r\n        }\r\n    });\r\n}\r\n/**\r\n* Gets all worlds owned by the logged in user.\r\n*/\r\nfunction getWorlds() {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const page = yield requestPage('/worlds');\r\n        const lines = page.split('\\n');\r\n        const worlds = [];\r\n        lines.forEach(line => {\r\n            if (/\\t\\tupdateWorld/.test(line)) {\r\n                const name = line.match(/name: '([^']+?)'/);\r\n                const id = line.match(/id: (\\d+)/);\r\n                worlds.push({\r\n                    name: unescapeHTML(name[1]),\r\n                    id: id[1]\r\n                });\r\n            }\r\n        });\r\n        return worlds;\r\n    });\r\n}\r\n/** @inheritdoc */\r\nclass Api {\r\n    constructor(info) {\r\n        this.info = info;\r\n        this.parser = new LogParser();\r\n        /** @inheritdoc */\r\n        this.getLists = () => __awaiter(this, void 0, void 0, function* () {\r\n            const page = yield requestPage(`/worlds/lists/${this.info.id}`);\r\n            const getList = (name) => {\r\n                let names = [];\r\n                const list = page.match(new RegExp(`<textarea name=\"${name}\">([\\\\s\\\\S]*?)</textarea>`));\r\n                if (list) {\r\n                    names = unescapeHTML(list[1])\r\n                        .split(/\\r?\\n/);\r\n                }\r\n                // Remove duplicates / blank lines\r\n                return Array.from(new Set(names)).filter(Boolean);\r\n            };\r\n            return {\r\n                adminlist: getList('admins'),\r\n                modlist: getList('modlist'),\r\n                whitelist: getList('whitelist'),\r\n                blacklist: getList('blacklist'),\r\n            };\r\n        });\r\n        /** @inheritdoc */\r\n        this.setLists = (lists) => __awaiter(this, void 0, void 0, function* () {\r\n            const makeSafe = (list) => encodeURIComponent(list.join('\\n'));\r\n            let body = `admins=${makeSafe(lists.adminlist)}`;\r\n            body += `&modlist=${makeSafe(lists.modlist)}`;\r\n            body += `&whitelist=${makeSafe(lists.whitelist)}`;\r\n            body += `&blacklist=${makeSafe(lists.blacklist)}`;\r\n            yield requestJSON(`/worlds/lists/${this.info.id}`, {\r\n                method: 'POST',\r\n                body\r\n            });\r\n        });\r\n        /** @inheritdoc */\r\n        this.getOverview = () => __awaiter(this, void 0, void 0, function* () {\r\n            const page = yield requestPage(`/worlds/${this.info.id}`);\r\n            const firstMatch = (r, fallback = '') => {\r\n                const m = page.match(r);\r\n                return m ? m[1] : fallback;\r\n            };\r\n            const privacy = firstMatch(/^\\$\\('#privacy'\\).val\\('(.*?)'\\)/m, 'public');\r\n            let online = [];\r\n            const match = page.match(/^\\t<tr><td class=\"left\">(.*?)(?=<\\/td>)/gm);\r\n            if (match) {\r\n                online = online.concat(match.map(s => s.substr(22)));\r\n            }\r\n            // This is very messy, refactoring welcome.\r\n            return {\r\n                name: firstMatch(/^\\t<title>(.*?) Manager \\| Portal<\\/title>$/m),\r\n                owner: firstMatch(/^\\t\\t<td class=\"right\">Owner:<\\/td>\\r?\\n\\t\\t<td>(.*?)<\\/td>$/m),\r\n                created: new Date(firstMatch(/^\\t\\t<td>Created:<\\/td><td>(.*?)<\\/td>$/m) + ' GMT-0000'),\r\n                last_activity: new Date(firstMatch(/^\\t\\t<td>Last Activity:<\\/td><td>(.*?)<\\/td>$/m) + ' GMT-0000'),\r\n                credit_until: new Date(firstMatch(/^\\t\\t<td>Credit Until:<\\/td><td>(.*?)<\\/td>$/m) + ' GMT-0000'),\r\n                link: firstMatch(/^\\t<tr><td>Link:<\\/td><td><a href=\"(.*?)\">\\1<\\/a>/m),\r\n                pvp: !!firstMatch(/^\\$\\('#pvp'\\)\\./m),\r\n                privacy,\r\n                password: firstMatch(/^\\t\\t<td>Password:<\\/td><td>(Yes|No)<\\/td><\\/tr>$/m) == 'Yes',\r\n                size: firstMatch(/^\\t\\t<td>Size:<\\/td><td>(.*?)<\\/td>$/m),\r\n                whitelist: firstMatch(/<td>Whitelist:<\\/td><td>(Yes|No)<\\/td>/m) == 'Yes',\r\n                online,\r\n                status: firstMatch(/^updateWorld\\({id: \\d+, worldStatus: '(.*?)'/m)\r\n            };\r\n        });\r\n        /** @inheritdoc */\r\n        this.getLogs = () => {\r\n            return requestPage(`/worlds/logs/${this.info.id}`)\r\n                .then(log => log.split('\\n'))\r\n                .then(lines => this.parser.parse(lines));\r\n        };\r\n        /** @inheritdoc */\r\n        this.getMessages = (lastId = 0) => {\r\n            return requestJSON('/api', {\r\n                method: 'POST',\r\n                body: `command=getchat&worldId=${this.info.id}&firstId=${lastId}`\r\n            })\r\n                .then(({ status, log, nextId }) => {\r\n                if (status != 'ok')\r\n                    return { log: [], nextId: 0 }; // Reset, world likely offline.\r\n                return { nextId, log };\r\n            }, () => ({ log: [], nextId: lastId })); //Network error, don't reset nextId\r\n        };\r\n        /** @inheritdoc */\r\n        this.getStatus = () => {\r\n            return requestJSON('/api', {\r\n                method: 'POST',\r\n                body: `command=status&worldId=${this.info.id}`\r\n            }).then(response => response.worldStatus);\r\n        };\r\n        /** @inheritdoc */\r\n        this.send = (message) => {\r\n            return requestJSON('/api', {\r\n                method: 'POST',\r\n                body: `command=send&worldId=${this.info.id}&message=${encodeURIComponent(message)}`\r\n            }).then(result => {\r\n                if (result.status == 'ok')\r\n                    return;\r\n                throw new Error(`Unable to send ${message}`);\r\n            });\r\n        };\r\n        /** @inheritdoc */\r\n        this.start = () => {\r\n            return requestJSON('/api', {\r\n                method: 'POST',\r\n                body: `command=start&worldId=${this.info.id}`\r\n            })\r\n                .then(() => undefined, console.error);\r\n        };\r\n        /** @inheritdoc */\r\n        this.stop = () => {\r\n            return requestJSON('/api', {\r\n                method: 'POST',\r\n                body: `command=stop&worldId=${this.info.id}`\r\n            })\r\n                .then(() => undefined, console.error);\r\n        };\r\n        /** @inheritdoc */\r\n        this.restart = () => {\r\n            return requestJSON('/api', {\r\n                method: 'POST',\r\n                body: `command=reboot&worldId=${this.info.id}`\r\n            })\r\n                .then(() => undefined, console.error);\r\n        };\r\n    }\r\n    /** @inheritdoc */\r\n    get name() {\r\n        return this.info.name;\r\n    }\r\n    /** @inheritdoc */\r\n    get id() {\r\n        return this.info.id;\r\n    }\r\n}\n\nexport { setFetch, login, getWorlds, Api };\n","import { MessageBot } from '@bhmb/bot';\n\nvar page = \"<header class=\\\"header is-fixed-top\\\">\\r\\n    <nav class=\\\"navbar is-primary\\\" role=\\\"navigation\\\" aria-label=\\\"main navigation\\\">\\r\\n        <div class=\\\"navbar-brand\\\">\\r\\n            <div class=\\\"navbar-item nav-slider-toggle\\\">\\r\\n                <img src=\\\"https://gitcdn.xyz/cdn/Blockheads-Messagebot/UI/master/logo.png\\\">\\r\\n            </div>\\r\\n            <a class=\\\"navbar-item nav-slider-toggle\\\">Menu</a>\\r\\n        </div>\\r\\n    </nav>\\r\\n</header>\\r\\n\\r\\n<div class=\\\"nav-slider-container\\\">\\r\\n    <nav class=\\\"nav-slider\\\"></nav>\\r\\n    <div class=\\\"is-overlay nav-slider-toggle\\\"></div>\\r\\n</div>\\r\\n\\r\\n<div id=\\\"container\\\" class=\\\"has-fixed-nav\\\"></div>\\r\\n\\r\\n\\r\\n<div id=\\\"modal\\\" class=\\\"modal\\\">\\r\\n    <div class=\\\"modal-background\\\"></div>\\r\\n    <div class=\\\"modal-card\\\">\\r\\n        <header class=\\\"modal-card-head\\\"></header>\\r\\n        <section class=\\\"modal-card-body\\\"></section>\\r\\n        <footer class=\\\"modal-card-foot\\\"></footer>\\r\\n    </div>\\r\\n</div>\\r\\n\";\n\nfunction api () {\r\n    const menuSlider = document.querySelector('.nav-slider-container .nav-slider');\r\n    const toggleMenu = () => menuSlider.classList.toggle('is-active');\r\n    for (let el of document.querySelectorAll('.nav-slider-toggle')) {\r\n        el.addEventListener('click', toggleMenu);\r\n    }\r\n    const tabs = new Map();\r\n    const groups = new Map();\r\n    const container = document.getElementById('container');\r\n    const menuContainer = document.querySelector('.nav-slider');\r\n    menuContainer.addEventListener('click', event => {\r\n        let nav = event.target;\r\n        let tab = tabs.get(nav);\r\n        if (tab) {\r\n            // Containers\r\n            Array.from(container.children).forEach(child => child.classList.remove('visible'));\r\n            tab.classList.add('visible');\r\n            // Nav items\r\n            Array.from(menuContainer.querySelectorAll('span.nav-item')).forEach(span => span.classList.remove('is-active'));\r\n            nav.classList.add('is-active');\r\n        }\r\n    });\r\n    const addTab = (text, groupName) => {\r\n        let div = container.appendChild(document.createElement('div'));\r\n        let parent = menuContainer;\r\n        if (groupName)\r\n            parent = groups.get(groupName);\r\n        let nav = parent.appendChild(document.createElement('span'));\r\n        nav.textContent = text;\r\n        nav.classList.add('nav-item');\r\n        tabs.set(nav, div);\r\n        return div;\r\n    };\r\n    const removeTab = (content) => {\r\n        for (let [nav, div] of tabs.entries()) {\r\n            if (div == content) {\r\n                div.remove();\r\n                nav.remove();\r\n                tabs.delete(nav);\r\n                return;\r\n            }\r\n        }\r\n    };\r\n    const addTabGroup = (text, groupName, parent) => {\r\n        let details = groups.get(groupName);\r\n        if (details) {\r\n            details.children[0].textContent = text;\r\n            return;\r\n        }\r\n        let parentElement = menuContainer;\r\n        if (parent)\r\n            parentElement = groups.get(parent);\r\n        details = parentElement.appendChild(document.createElement('details'));\r\n        details.classList.add('nav-item');\r\n        let summary = details.appendChild(document.createElement('summary'));\r\n        summary.textContent = text;\r\n        groups.set(groupName, details);\r\n    };\r\n    const removeTabGroup = (groupName) => {\r\n        let group = groups.get(groupName);\r\n        if (!group)\r\n            return;\r\n        for (let child of group.querySelectorAll('span')) {\r\n            // Unless someone has been purposely messing with the page, this is a safe assertion\r\n            removeTab(tabs.get(child));\r\n        }\r\n        groups.delete(groupName);\r\n        group.remove();\r\n    };\r\n    const handleRule = (rule, element) => {\r\n        if (typeof rule.text == 'string') {\r\n            element.textContent = rule.text;\r\n        }\r\n        else if (typeof rule.html == 'string') {\r\n            element.innerHTML = rule.html;\r\n        }\r\n        let blacklist = ['text', 'html', 'selector'];\r\n        if (element instanceof HTMLTextAreaElement && 'value' in rule) {\r\n            element.textContent = rule.value;\r\n            blacklist.push('value');\r\n        }\r\n        //See https://github.com/Blockheads-Messagebot/MessageBot/issues/52\r\n        if (element instanceof HTMLSelectElement && 'value' in rule) {\r\n            let child = element.querySelector(`[value=\"${rule.value}\"]`);\r\n            if (child)\r\n                child.selected = true;\r\n        }\r\n        Object.keys(rule)\r\n            .filter(key => !blacklist.includes(key))\r\n            .forEach(key => element.setAttribute(key, rule[key]));\r\n    };\r\n    const buildTemplate = (template, target, rules) => {\r\n        if (typeof template == 'string')\r\n            template = document.querySelector(template);\r\n        if (typeof target == 'string')\r\n            target = document.querySelector(target);\r\n        let parent = document.importNode(template.content, true);\r\n        for (let rule of rules) {\r\n            let element = parent.querySelector(rule.selector);\r\n            if (!element) {\r\n                console.warn(`Could not find ${rule.selector}`, rule);\r\n                continue;\r\n            }\r\n            handleRule(rule, element);\r\n        }\r\n        target.appendChild(parent);\r\n    };\r\n    const notify = (text, displayTime = 3) => {\r\n        let el = document.body.appendChild(document.createElement('div'));\r\n        el.classList.add('bot-notification', 'is-active');\r\n        el.textContent = text;\r\n        let timeouts = [\r\n            setTimeout(() => el.classList.remove('is-active'), displayTime * 1000),\r\n            setTimeout(() => el.remove(), (displayTime + 1) * 1000)\r\n        ];\r\n        el.addEventListener('click', () => {\r\n            timeouts.forEach(clearTimeout);\r\n            el.remove();\r\n        });\r\n    };\r\n    let alertInstance = {\r\n        active: false,\r\n        queue: []\r\n    };\r\n    const modal = document.getElementById('modal');\r\n    const modalBody = modal.querySelector('.modal-card-body');\r\n    const modalFooter = modal.querySelector('.modal-card-foot');\r\n    const addButton = (button) => {\r\n        let el = modalFooter.appendChild(document.createElement('a'));\r\n        let styles = ['button'];\r\n        if (typeof button == 'object') {\r\n            if (button.style)\r\n                styles.push(button.style);\r\n            el.textContent = button.text;\r\n        }\r\n        else {\r\n            el.textContent = button;\r\n        }\r\n        el.classList.add(...styles);\r\n    };\r\n    const showAlert = () => {\r\n        alertInstance.active = true;\r\n        const { html, buttons, callback } = alertInstance.queue.shift();\r\n        modalBody.innerHTML = html;\r\n        Array.isArray(buttons) ? buttons.forEach(addButton) : addButton('OK');\r\n        modal.classList.add('is-active');\r\n        modalFooter.addEventListener('click', function buttonHandler(event) {\r\n            let target = event.target;\r\n            if (target.tagName != 'A')\r\n                return;\r\n            modal.classList.remove('is-active');\r\n            try {\r\n                if (callback)\r\n                    callback.call(null, target.textContent);\r\n            }\r\n            catch (err) {\r\n                console.error('Error calling alert callback', err);\r\n            }\r\n            modalFooter.innerHTML = '';\r\n            modalFooter.removeEventListener('click', buttonHandler);\r\n            alertInstance.active = false;\r\n            if (alertInstance.queue.length)\r\n                showAlert();\r\n        });\r\n    };\r\n    const alert = (html, buttons, callback) => {\r\n        alertInstance.queue.push({ html, buttons, callback });\r\n        if (!alertInstance.active)\r\n            showAlert();\r\n    };\r\n    const prompt = (text, callback) => {\r\n        let p = document.createElement('p');\r\n        p.textContent = text;\r\n        alert(p.outerHTML + `<textarea class=\"textarea\"></textarea>`, ['OK', 'Cancel'], () => {\r\n            let el = modalBody.querySelector('textarea');\r\n            if (callback)\r\n                callback(el.value || '');\r\n        });\r\n    };\r\n    return {\r\n        toggleMenu,\r\n        addTab,\r\n        removeTab,\r\n        addTabGroup,\r\n        removeTabGroup,\r\n        buildTemplate,\r\n        notify,\r\n        alert,\r\n        prompt\r\n    };\r\n}\n\nfunction polyfill() {\r\n    if (!('open' in document.createElement('details'))) {\r\n        let style = document.createElement('style');\r\n        style.textContent += `details:not([open]) > :not(summary) { display: none !important } details > summary:before { content: \"▶\" display: inline-block font-size: .8em width: 1.5em font-family:\"Courier New\" } details[open] > summary:before { transform: rotate(90deg) }`;\r\n        document.head.appendChild(style);\r\n        window.addEventListener('click', function (event) {\r\n            let target = event.target;\r\n            if (target.tagName == 'SUMMARY') {\r\n                let details = target.parentNode;\r\n                if (!details) {\r\n                    return;\r\n                }\r\n                if (details.getAttribute('open')) {\r\n                    details.open = false;\r\n                    details.removeAttribute('open');\r\n                }\r\n                else {\r\n                    details.open = true;\r\n                    details.setAttribute('open', 'open');\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\n\nMessageBot.registerExtension('ui', function (ex) {\r\n    if (typeof document == 'undefined') {\r\n        throw new Error('This extension cannot be loaded outside of a browser environment.');\r\n    }\r\n    ex.uninstall = function () {\r\n        throw new Error('The UI extension cannot be removed once loaded');\r\n    };\r\n    // Page creation\r\n    document.body.innerHTML = page;\r\n    document.head.querySelectorAll('link').forEach(el => el.remove());\r\n    let style = document.head.appendChild(document.createElement('link'));\r\n    style.rel = 'stylesheet';\r\n    style.href = 'https://gitcdn.xyz/cdn/Blockheads-Messagebot/UI/master/index.css';\r\n    polyfill();\r\n    // Expose api\r\n    ex.exports = api();\r\n});\n","import { MessageBot } from '@bhmb/bot';\n\nfunction checkJoins(player, message) {\r\n    return player.joins >= message.joins_low && player.joins <= message.joins_high;\r\n}\r\nfunction checkGroups(player, message) {\r\n    return isInGroup(player, message.group) && !isInGroup(player, message.not_group);\r\n}\r\nfunction isInGroup(player, group) {\r\n    switch (group) {\r\n        case 'all':\r\n            return true;\r\n        case 'staff':\r\n            return player.isStaff;\r\n        case 'mod':\r\n            return player.isMod;\r\n        case 'admin':\r\n            return player.isAdmin;\r\n        case 'owner':\r\n            return player.isOwner;\r\n        default:\r\n            return false;\r\n    }\r\n}\n\nclass RemovableMessageHelper {\r\n    constructor(id, ex) {\r\n        this.id = id;\r\n        this.ex = ex;\r\n    }\r\n    get messages() {\r\n        return this.ex.storage.get(this.id, []);\r\n    }\r\n}\r\nclass JoinListener extends RemovableMessageHelper {\r\n    constructor(ex) {\r\n        super('joinArr', ex);\r\n        this.listener = (player) => {\r\n            for (let msg of this.messages) {\r\n                if (checkJoins(player, msg) && checkGroups(player, msg)) {\r\n                    this.ex.bot.send(msg.message, { name: player.name });\r\n                }\r\n            }\r\n        };\r\n        this.ex.world.onJoin.sub(this.listener);\r\n    }\r\n    remove() {\r\n        this.ex.world.onJoin.unsub(this.listener);\r\n    }\r\n}\r\nclass LeaveListener extends RemovableMessageHelper {\r\n    constructor(ex) {\r\n        super('leaveArr', ex);\r\n        this.listener = (player) => {\r\n            for (let msg of this.messages) {\r\n                if (checkJoins(player, msg) && checkGroups(player, msg)) {\r\n                    this.ex.bot.send(msg.message, { name: player.name });\r\n                }\r\n            }\r\n        };\r\n        this.ex.world.onLeave.sub(this.listener);\r\n    }\r\n    remove() {\r\n        this.ex.world.onLeave.unsub(this.listener);\r\n    }\r\n}\r\nclass TriggerListener extends RemovableMessageHelper {\r\n    constructor(ex) {\r\n        super('triggerArr', ex);\r\n        this.listener = ({ player, message }) => {\r\n            if (player.name == 'SERVER')\r\n                return;\r\n            let responses = 0;\r\n            for (let msg of this.messages) {\r\n                let checks = [\r\n                    checkJoins(player, msg),\r\n                    checkGroups(player, msg),\r\n                    this.triggerMatches(message, msg.trigger)\r\n                ];\r\n                if (checks.every(Boolean) && ++responses <= this.ex.storage.get('maxResponses', 3)) {\r\n                    this.ex.bot.send(msg.message, { name: player.name });\r\n                }\r\n            }\r\n        };\r\n        this.ex.world.onMessage.sub(this.listener);\r\n    }\r\n    remove() {\r\n        this.ex.world.onMessage.unsub(this.listener);\r\n    }\r\n    triggerMatches(message, trigger) {\r\n        if (!this.ex.storage.get('disableWhitespaceTrimming', false)) {\r\n            trigger = trigger.trim();\r\n        }\r\n        if (this.ex.storage.get('regexTriggers', false)) {\r\n            try {\r\n                return new RegExp(trigger, 'i').test(message);\r\n            }\r\n            catch (_a) {\r\n                return false;\r\n            }\r\n        }\r\n        trigger = trigger.replace(/([.+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\").replace(/\\*/g, \".*\");\r\n        return new RegExp(trigger, 'i').test(message);\r\n    }\r\n}\r\nclass AnnouncementListener extends RemovableMessageHelper {\r\n    constructor(ex) {\r\n        super('announcementArr', ex);\r\n        this.index = 0;\r\n        this.run = () => {\r\n            if (this.index >= this.messages.length)\r\n                this.index = 0;\r\n            if (!this.ex.world.online.length) {\r\n                this.index = 0;\r\n            }\r\n            else {\r\n                const data = this.messages[this.index];\r\n                if (data && data.message)\r\n                    this.ex.bot.send(data.message);\r\n            }\r\n            this.timeoutId = setTimeout(this.run, this.delay);\r\n        };\r\n        this.timeoutId = setTimeout(this.run, this.delay);\r\n    }\r\n    get delay() {\r\n        return this.ex.storage.get('announcementDelay', 10) * 60000;\r\n    }\r\n    remove() {\r\n        // This will also work with Timer, but Typescript doesn't know that.\r\n        clearTimeout(this.timeoutId);\r\n    }\r\n}\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\n\nvar commonjsGlobal = typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\n\nvar atoa = function atoa (a, n) { return Array.prototype.slice.call(a, n); };\n\nvar si = typeof setImmediate === 'function', tick;\nif (si) {\n  tick = function (fn) { setImmediate(fn); };\n} else if (typeof process !== 'undefined' && process.nextTick) {\n  tick = process.nextTick;\n} else {\n  tick = function (fn) { setTimeout(fn, 0); };\n}\n\nvar ticky = tick;\n\nvar debounce = function debounce (fn, args, ctx) {\n  if (!fn) { return; }\n  ticky(function run () {\n    fn.apply(ctx || null, args || []);\n  });\n};\n\nvar emitter = function emitter (thing, options) {\n  var opts = options || {};\n  var evt = {};\n  if (thing === undefined) { thing = {}; }\n  thing.on = function (type, fn) {\n    if (!evt[type]) {\n      evt[type] = [fn];\n    } else {\n      evt[type].push(fn);\n    }\n    return thing;\n  };\n  thing.once = function (type, fn) {\n    fn._once = true; // thing.off(fn) still works!\n    thing.on(type, fn);\n    return thing;\n  };\n  thing.off = function (type, fn) {\n    var c = arguments.length;\n    if (c === 1) {\n      delete evt[type];\n    } else if (c === 0) {\n      evt = {};\n    } else {\n      var et = evt[type];\n      if (!et) { return thing; }\n      et.splice(et.indexOf(fn), 1);\n    }\n    return thing;\n  };\n  thing.emit = function () {\n    var args = atoa(arguments);\n    return thing.emitterSnapshot(args.shift()).apply(this, args);\n  };\n  thing.emitterSnapshot = function (type) {\n    var et = (evt[type] || []).slice(0);\n    return function () {\n      var args = atoa(arguments);\n      var ctx = this || thing;\n      if (type === 'error' && opts.throws !== false && !et.length) { throw args.length === 1 ? args[0] : args; }\n      et.forEach(function emitter (listen) {\n        if (opts.async) { debounce(listen, args, ctx); } else { listen.apply(ctx, args); }\n        if (listen._once) { thing.off(type, listen); }\n      });\n      return thing;\n    };\n  };\n  return thing;\n};\n\nvar NativeCustomEvent = commonjsGlobal.CustomEvent;\n\nfunction useNative () {\n  try {\n    var p = new NativeCustomEvent('cat', { detail: { foo: 'bar' } });\n    return  'cat' === p.type && 'bar' === p.detail.foo;\n  } catch (e) {\n  }\n  return false;\n}\n\n/**\n * Cross-browser `CustomEvent` constructor.\n *\n * https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent.CustomEvent\n *\n * @public\n */\n\nvar customEvent = useNative() ? NativeCustomEvent :\n\n// IE >= 9\n'function' === typeof document.createEvent ? function CustomEvent (type, params) {\n  var e = document.createEvent('CustomEvent');\n  if (params) {\n    e.initCustomEvent(type, params.bubbles, params.cancelable, params.detail);\n  } else {\n    e.initCustomEvent(type, false, false, void 0);\n  }\n  return e;\n} :\n\n// IE <= 8\nfunction CustomEvent (type, params) {\n  var e = document.createEventObject();\n  e.type = type;\n  if (params) {\n    e.bubbles = Boolean(params.bubbles);\n    e.cancelable = Boolean(params.cancelable);\n    e.detail = params.detail;\n  } else {\n    e.bubbles = false;\n    e.cancelable = false;\n    e.detail = void 0;\n  }\n  return e;\n};\n\nvar eventmap = [];\nvar eventname = '';\nvar ron = /^on/;\n\nfor (eventname in commonjsGlobal) {\n  if (ron.test(eventname)) {\n    eventmap.push(eventname.slice(2));\n  }\n}\n\nvar eventmap_1 = eventmap;\n\nvar doc = commonjsGlobal.document;\nvar addEvent = addEventEasy;\nvar removeEvent = removeEventEasy;\nvar hardCache = [];\n\nif (!commonjsGlobal.addEventListener) {\n  addEvent = addEventHard;\n  removeEvent = removeEventHard;\n}\n\nvar crossvent = {\n  add: addEvent,\n  remove: removeEvent,\n  fabricate: fabricateEvent\n};\n\nfunction addEventEasy (el, type, fn, capturing) {\n  return el.addEventListener(type, fn, capturing);\n}\n\nfunction addEventHard (el, type, fn) {\n  return el.attachEvent('on' + type, wrap(el, type, fn));\n}\n\nfunction removeEventEasy (el, type, fn, capturing) {\n  return el.removeEventListener(type, fn, capturing);\n}\n\nfunction removeEventHard (el, type, fn) {\n  var listener = unwrap(el, type, fn);\n  if (listener) {\n    return el.detachEvent('on' + type, listener);\n  }\n}\n\nfunction fabricateEvent (el, type, model) {\n  var e = eventmap_1.indexOf(type) === -1 ? makeCustomEvent() : makeClassicEvent();\n  if (el.dispatchEvent) {\n    el.dispatchEvent(e);\n  } else {\n    el.fireEvent('on' + type, e);\n  }\n  function makeClassicEvent () {\n    var e;\n    if (doc.createEvent) {\n      e = doc.createEvent('Event');\n      e.initEvent(type, true, true);\n    } else if (doc.createEventObject) {\n      e = doc.createEventObject();\n    }\n    return e;\n  }\n  function makeCustomEvent () {\n    return new customEvent(type, { detail: model });\n  }\n}\n\nfunction wrapperFactory (el, type, fn) {\n  return function wrapper (originalEvent) {\n    var e = originalEvent || commonjsGlobal.event;\n    e.target = e.target || e.srcElement;\n    e.preventDefault = e.preventDefault || function preventDefault () { e.returnValue = false; };\n    e.stopPropagation = e.stopPropagation || function stopPropagation () { e.cancelBubble = true; };\n    e.which = e.which || e.keyCode;\n    fn.call(el, e);\n  };\n}\n\nfunction wrap (el, type, fn) {\n  var wrapper = unwrap(el, type, fn) || wrapperFactory(el, type, fn);\n  hardCache.push({\n    wrapper: wrapper,\n    element: el,\n    type: type,\n    fn: fn\n  });\n  return wrapper;\n}\n\nfunction unwrap (el, type, fn) {\n  var i = find(el, type, fn);\n  if (i) {\n    var wrapper = hardCache[i].wrapper;\n    hardCache.splice(i, 1); // free up a tad of memory\n    return wrapper;\n  }\n}\n\nfunction find (el, type, fn) {\n  var i, item;\n  for (i = 0; i < hardCache.length; i++) {\n    item = hardCache[i];\n    if (item.element === el && item.type === type && item.fn === fn) {\n      return i;\n    }\n  }\n}\n\nvar cache = {};\nvar start = '(?:^|\\\\s)';\nvar end = '(?:\\\\s|$)';\n\nfunction lookupClass (className) {\n  var cached = cache[className];\n  if (cached) {\n    cached.lastIndex = 0;\n  } else {\n    cache[className] = cached = new RegExp(start + className + end, 'g');\n  }\n  return cached;\n}\n\nfunction addClass (el, className) {\n  var current = el.className;\n  if (!current.length) {\n    el.className = className;\n  } else if (!lookupClass(className).test(current)) {\n    el.className += ' ' + className;\n  }\n}\n\nfunction rmClass (el, className) {\n  el.className = el.className.replace(lookupClass(className), ' ').trim();\n}\n\nvar classes = {\n  add: addClass,\n  rm: rmClass\n};\n\nvar doc$1 = document;\nvar documentElement = doc$1.documentElement;\n\nfunction dragula (initialContainers, options) {\n  var len = arguments.length;\n  if (len === 1 && Array.isArray(initialContainers) === false) {\n    options = initialContainers;\n    initialContainers = [];\n  }\n  var _mirror; // mirror image\n  var _source; // source container\n  var _item; // item being dragged\n  var _offsetX; // reference x\n  var _offsetY; // reference y\n  var _moveX; // reference move x\n  var _moveY; // reference move y\n  var _initialSibling; // reference sibling when grabbed\n  var _currentSibling; // reference sibling now\n  var _copy; // item used for copying\n  var _renderTimer; // timer for setTimeout renderMirrorImage\n  var _lastDropTarget = null; // last container item was over\n  var _grabbed; // holds mousedown context until first mousemove\n\n  var o = options || {};\n  if (o.moves === void 0) { o.moves = always; }\n  if (o.accepts === void 0) { o.accepts = always; }\n  if (o.invalid === void 0) { o.invalid = invalidTarget; }\n  if (o.containers === void 0) { o.containers = initialContainers || []; }\n  if (o.isContainer === void 0) { o.isContainer = never; }\n  if (o.copy === void 0) { o.copy = false; }\n  if (o.copySortSource === void 0) { o.copySortSource = false; }\n  if (o.revertOnSpill === void 0) { o.revertOnSpill = false; }\n  if (o.removeOnSpill === void 0) { o.removeOnSpill = false; }\n  if (o.direction === void 0) { o.direction = 'vertical'; }\n  if (o.ignoreInputTextSelection === void 0) { o.ignoreInputTextSelection = true; }\n  if (o.mirrorContainer === void 0) { o.mirrorContainer = doc$1.body; }\n\n  var drake = emitter({\n    containers: o.containers,\n    start: manualStart,\n    end: end,\n    cancel: cancel,\n    remove: remove,\n    destroy: destroy,\n    canMove: canMove,\n    dragging: false\n  });\n\n  if (o.removeOnSpill === true) {\n    drake.on('over', spillOver).on('out', spillOut);\n  }\n\n  events();\n\n  return drake;\n\n  function isContainer (el) {\n    return drake.containers.indexOf(el) !== -1 || o.isContainer(el);\n  }\n\n  function events (remove) {\n    var op = remove ? 'remove' : 'add';\n    touchy(documentElement, op, 'mousedown', grab);\n    touchy(documentElement, op, 'mouseup', release);\n  }\n\n  function eventualMovements (remove) {\n    var op = remove ? 'remove' : 'add';\n    touchy(documentElement, op, 'mousemove', startBecauseMouseMoved);\n  }\n\n  function movements (remove) {\n    var op = remove ? 'remove' : 'add';\n    crossvent[op](documentElement, 'selectstart', preventGrabbed); // IE8\n    crossvent[op](documentElement, 'click', preventGrabbed);\n  }\n\n  function destroy () {\n    events(true);\n    release({});\n  }\n\n  function preventGrabbed (e) {\n    if (_grabbed) {\n      e.preventDefault();\n    }\n  }\n\n  function grab (e) {\n    _moveX = e.clientX;\n    _moveY = e.clientY;\n\n    var ignore = whichMouseButton(e) !== 1 || e.metaKey || e.ctrlKey;\n    if (ignore) {\n      return; // we only care about honest-to-god left clicks and touch events\n    }\n    var item = e.target;\n    var context = canStart(item);\n    if (!context) {\n      return;\n    }\n    _grabbed = context;\n    eventualMovements();\n    if (e.type === 'mousedown') {\n      if (isInput(item)) { // see also: https://github.com/bevacqua/dragula/issues/208\n        item.focus(); // fixes https://github.com/bevacqua/dragula/issues/176\n      } else {\n        e.preventDefault(); // fixes https://github.com/bevacqua/dragula/issues/155\n      }\n    }\n  }\n\n  function startBecauseMouseMoved (e) {\n    if (!_grabbed) {\n      return;\n    }\n    if (whichMouseButton(e) === 0) {\n      release({});\n      return; // when text is selected on an input and then dragged, mouseup doesn't fire. this is our only hope\n    }\n    // truthy check fixes #239, equality fixes #207\n    if (e.clientX !== void 0 && e.clientX === _moveX && e.clientY !== void 0 && e.clientY === _moveY) {\n      return;\n    }\n    if (o.ignoreInputTextSelection) {\n      var clientX = getCoord('clientX', e);\n      var clientY = getCoord('clientY', e);\n      var elementBehindCursor = doc$1.elementFromPoint(clientX, clientY);\n      if (isInput(elementBehindCursor)) {\n        return;\n      }\n    }\n\n    var grabbed = _grabbed; // call to end() unsets _grabbed\n    eventualMovements(true);\n    movements();\n    end();\n    start(grabbed);\n\n    var offset = getOffset(_item);\n    _offsetX = getCoord('pageX', e) - offset.left;\n    _offsetY = getCoord('pageY', e) - offset.top;\n\n    classes.add(_copy || _item, 'gu-transit');\n    renderMirrorImage();\n    drag(e);\n  }\n\n  function canStart (item) {\n    if (drake.dragging && _mirror) {\n      return;\n    }\n    if (isContainer(item)) {\n      return; // don't drag container itself\n    }\n    var handle = item;\n    while (getParent(item) && isContainer(getParent(item)) === false) {\n      if (o.invalid(item, handle)) {\n        return;\n      }\n      item = getParent(item); // drag target should be a top element\n      if (!item) {\n        return;\n      }\n    }\n    var source = getParent(item);\n    if (!source) {\n      return;\n    }\n    if (o.invalid(item, handle)) {\n      return;\n    }\n\n    var movable = o.moves(item, source, handle, nextEl(item));\n    if (!movable) {\n      return;\n    }\n\n    return {\n      item: item,\n      source: source\n    };\n  }\n\n  function canMove (item) {\n    return !!canStart(item);\n  }\n\n  function manualStart (item) {\n    var context = canStart(item);\n    if (context) {\n      start(context);\n    }\n  }\n\n  function start (context) {\n    if (isCopy(context.item, context.source)) {\n      _copy = context.item.cloneNode(true);\n      drake.emit('cloned', _copy, context.item, 'copy');\n    }\n\n    _source = context.source;\n    _item = context.item;\n    _initialSibling = _currentSibling = nextEl(context.item);\n\n    drake.dragging = true;\n    drake.emit('drag', _item, _source);\n  }\n\n  function invalidTarget () {\n    return false;\n  }\n\n  function end () {\n    if (!drake.dragging) {\n      return;\n    }\n    var item = _copy || _item;\n    drop(item, getParent(item));\n  }\n\n  function ungrab () {\n    _grabbed = false;\n    eventualMovements(true);\n    movements(true);\n  }\n\n  function release (e) {\n    ungrab();\n\n    if (!drake.dragging) {\n      return;\n    }\n    var item = _copy || _item;\n    var clientX = getCoord('clientX', e);\n    var clientY = getCoord('clientY', e);\n    var elementBehindCursor = getElementBehindPoint(_mirror, clientX, clientY);\n    var dropTarget = findDropTarget(elementBehindCursor, clientX, clientY);\n    if (dropTarget && ((_copy && o.copySortSource) || (!_copy || dropTarget !== _source))) {\n      drop(item, dropTarget);\n    } else if (o.removeOnSpill) {\n      remove();\n    } else {\n      cancel();\n    }\n  }\n\n  function drop (item, target) {\n    var parent = getParent(item);\n    if (_copy && o.copySortSource && target === _source) {\n      parent.removeChild(_item);\n    }\n    if (isInitialPlacement(target)) {\n      drake.emit('cancel', item, _source, _source);\n    } else {\n      drake.emit('drop', item, target, _source, _currentSibling);\n    }\n    cleanup();\n  }\n\n  function remove () {\n    if (!drake.dragging) {\n      return;\n    }\n    var item = _copy || _item;\n    var parent = getParent(item);\n    if (parent) {\n      parent.removeChild(item);\n    }\n    drake.emit(_copy ? 'cancel' : 'remove', item, parent, _source);\n    cleanup();\n  }\n\n  function cancel (revert) {\n    if (!drake.dragging) {\n      return;\n    }\n    var reverts = arguments.length > 0 ? revert : o.revertOnSpill;\n    var item = _copy || _item;\n    var parent = getParent(item);\n    var initial = isInitialPlacement(parent);\n    if (initial === false && reverts) {\n      if (_copy) {\n        if (parent) {\n          parent.removeChild(_copy);\n        }\n      } else {\n        _source.insertBefore(item, _initialSibling);\n      }\n    }\n    if (initial || reverts) {\n      drake.emit('cancel', item, _source, _source);\n    } else {\n      drake.emit('drop', item, parent, _source, _currentSibling);\n    }\n    cleanup();\n  }\n\n  function cleanup () {\n    var item = _copy || _item;\n    ungrab();\n    removeMirrorImage();\n    if (item) {\n      classes.rm(item, 'gu-transit');\n    }\n    if (_renderTimer) {\n      clearTimeout(_renderTimer);\n    }\n    drake.dragging = false;\n    if (_lastDropTarget) {\n      drake.emit('out', item, _lastDropTarget, _source);\n    }\n    drake.emit('dragend', item);\n    _source = _item = _copy = _initialSibling = _currentSibling = _renderTimer = _lastDropTarget = null;\n  }\n\n  function isInitialPlacement (target, s) {\n    var sibling;\n    if (s !== void 0) {\n      sibling = s;\n    } else if (_mirror) {\n      sibling = _currentSibling;\n    } else {\n      sibling = nextEl(_copy || _item);\n    }\n    return target === _source && sibling === _initialSibling;\n  }\n\n  function findDropTarget (elementBehindCursor, clientX, clientY) {\n    var target = elementBehindCursor;\n    while (target && !accepted()) {\n      target = getParent(target);\n    }\n    return target;\n\n    function accepted () {\n      var droppable = isContainer(target);\n      if (droppable === false) {\n        return false;\n      }\n\n      var immediate = getImmediateChild(target, elementBehindCursor);\n      var reference = getReference(target, immediate, clientX, clientY);\n      var initial = isInitialPlacement(target, reference);\n      if (initial) {\n        return true; // should always be able to drop it right back where it was\n      }\n      return o.accepts(_item, target, _source, reference);\n    }\n  }\n\n  function drag (e) {\n    if (!_mirror) {\n      return;\n    }\n    e.preventDefault();\n\n    var clientX = getCoord('clientX', e);\n    var clientY = getCoord('clientY', e);\n    var x = clientX - _offsetX;\n    var y = clientY - _offsetY;\n\n    _mirror.style.left = x + 'px';\n    _mirror.style.top = y + 'px';\n\n    var item = _copy || _item;\n    var elementBehindCursor = getElementBehindPoint(_mirror, clientX, clientY);\n    var dropTarget = findDropTarget(elementBehindCursor, clientX, clientY);\n    var changed = dropTarget !== null && dropTarget !== _lastDropTarget;\n    if (changed || dropTarget === null) {\n      out();\n      _lastDropTarget = dropTarget;\n      over();\n    }\n    var parent = getParent(item);\n    if (dropTarget === _source && _copy && !o.copySortSource) {\n      if (parent) {\n        parent.removeChild(item);\n      }\n      return;\n    }\n    var reference;\n    var immediate = getImmediateChild(dropTarget, elementBehindCursor);\n    if (immediate !== null) {\n      reference = getReference(dropTarget, immediate, clientX, clientY);\n    } else if (o.revertOnSpill === true && !_copy) {\n      reference = _initialSibling;\n      dropTarget = _source;\n    } else {\n      if (_copy && parent) {\n        parent.removeChild(item);\n      }\n      return;\n    }\n    if (\n      (reference === null && changed) ||\n      reference !== item &&\n      reference !== nextEl(item)\n    ) {\n      _currentSibling = reference;\n      dropTarget.insertBefore(item, reference);\n      drake.emit('shadow', item, dropTarget, _source);\n    }\n    function moved (type) { drake.emit(type, item, _lastDropTarget, _source); }\n    function over () { if (changed) { moved('over'); } }\n    function out () { if (_lastDropTarget) { moved('out'); } }\n  }\n\n  function spillOver (el) {\n    classes.rm(el, 'gu-hide');\n  }\n\n  function spillOut (el) {\n    if (drake.dragging) { classes.add(el, 'gu-hide'); }\n  }\n\n  function renderMirrorImage () {\n    if (_mirror) {\n      return;\n    }\n    var rect = _item.getBoundingClientRect();\n    _mirror = _item.cloneNode(true);\n    _mirror.style.width = getRectWidth(rect) + 'px';\n    _mirror.style.height = getRectHeight(rect) + 'px';\n    classes.rm(_mirror, 'gu-transit');\n    classes.add(_mirror, 'gu-mirror');\n    o.mirrorContainer.appendChild(_mirror);\n    touchy(documentElement, 'add', 'mousemove', drag);\n    classes.add(o.mirrorContainer, 'gu-unselectable');\n    drake.emit('cloned', _mirror, _item, 'mirror');\n  }\n\n  function removeMirrorImage () {\n    if (_mirror) {\n      classes.rm(o.mirrorContainer, 'gu-unselectable');\n      touchy(documentElement, 'remove', 'mousemove', drag);\n      getParent(_mirror).removeChild(_mirror);\n      _mirror = null;\n    }\n  }\n\n  function getImmediateChild (dropTarget, target) {\n    var immediate = target;\n    while (immediate !== dropTarget && getParent(immediate) !== dropTarget) {\n      immediate = getParent(immediate);\n    }\n    if (immediate === documentElement) {\n      return null;\n    }\n    return immediate;\n  }\n\n  function getReference (dropTarget, target, x, y) {\n    var horizontal = o.direction === 'horizontal';\n    var reference = target !== dropTarget ? inside() : outside();\n    return reference;\n\n    function outside () { // slower, but able to figure out any position\n      var len = dropTarget.children.length;\n      var i;\n      var el;\n      var rect;\n      for (i = 0; i < len; i++) {\n        el = dropTarget.children[i];\n        rect = el.getBoundingClientRect();\n        if (horizontal && (rect.left + rect.width / 2) > x) { return el; }\n        if (!horizontal && (rect.top + rect.height / 2) > y) { return el; }\n      }\n      return null;\n    }\n\n    function inside () { // faster, but only available if dropped inside a child element\n      var rect = target.getBoundingClientRect();\n      if (horizontal) {\n        return resolve(x > rect.left + getRectWidth(rect) / 2);\n      }\n      return resolve(y > rect.top + getRectHeight(rect) / 2);\n    }\n\n    function resolve (after) {\n      return after ? nextEl(target) : target;\n    }\n  }\n\n  function isCopy (item, container) {\n    return typeof o.copy === 'boolean' ? o.copy : o.copy(item, container);\n  }\n}\n\nfunction touchy (el, op, type, fn) {\n  var touch = {\n    mouseup: 'touchend',\n    mousedown: 'touchstart',\n    mousemove: 'touchmove'\n  };\n  var pointers = {\n    mouseup: 'pointerup',\n    mousedown: 'pointerdown',\n    mousemove: 'pointermove'\n  };\n  var microsoft = {\n    mouseup: 'MSPointerUp',\n    mousedown: 'MSPointerDown',\n    mousemove: 'MSPointerMove'\n  };\n  if (commonjsGlobal.navigator.pointerEnabled) {\n    crossvent[op](el, pointers[type], fn);\n  } else if (commonjsGlobal.navigator.msPointerEnabled) {\n    crossvent[op](el, microsoft[type], fn);\n  } else {\n    crossvent[op](el, touch[type], fn);\n    crossvent[op](el, type, fn);\n  }\n}\n\nfunction whichMouseButton (e) {\n  if (e.touches !== void 0) { return e.touches.length; }\n  if (e.which !== void 0 && e.which !== 0) { return e.which; } // see https://github.com/bevacqua/dragula/issues/261\n  if (e.buttons !== void 0) { return e.buttons; }\n  var button = e.button;\n  if (button !== void 0) { // see https://github.com/jquery/jquery/blob/99e8ff1baa7ae341e94bb89c3e84570c7c3ad9ea/src/event.js#L573-L575\n    return button & 1 ? 1 : button & 2 ? 3 : (button & 4 ? 2 : 0);\n  }\n}\n\nfunction getOffset (el) {\n  var rect = el.getBoundingClientRect();\n  return {\n    left: rect.left + getScroll('scrollLeft', 'pageXOffset'),\n    top: rect.top + getScroll('scrollTop', 'pageYOffset')\n  };\n}\n\nfunction getScroll (scrollProp, offsetProp) {\n  if (typeof commonjsGlobal[offsetProp] !== 'undefined') {\n    return commonjsGlobal[offsetProp];\n  }\n  if (documentElement.clientHeight) {\n    return documentElement[scrollProp];\n  }\n  return doc$1.body[scrollProp];\n}\n\nfunction getElementBehindPoint (point, x, y) {\n  var p = point || {};\n  var state = p.className;\n  var el;\n  p.className += ' gu-hide';\n  el = doc$1.elementFromPoint(x, y);\n  p.className = state;\n  return el;\n}\n\nfunction never () { return false; }\nfunction always () { return true; }\nfunction getRectWidth (rect) { return rect.width || (rect.right - rect.left); }\nfunction getRectHeight (rect) { return rect.height || (rect.bottom - rect.top); }\nfunction getParent (el) { return el.parentNode === doc$1 ? null : el.parentNode; }\nfunction isInput (el) { return el.tagName === 'INPUT' || el.tagName === 'TEXTAREA' || el.tagName === 'SELECT' || isEditable(el); }\nfunction isEditable (el) {\n  if (!el) { return false; } // no parents were editable\n  if (el.contentEditable === 'false') { return false; } // stop the lookup\n  if (el.contentEditable === 'true') { return true; } // found a contentEditable element in the chain\n  return isEditable(getParent(el)); // contentEditable is set to 'inherit'\n}\n\nfunction nextEl (el) {\n  return el.nextElementSibling || manually();\n  function manually () {\n    var sibling = el;\n    do {\n      sibling = sibling.nextSibling;\n    } while (sibling && sibling.nodeType !== 1);\n    return sibling;\n  }\n}\n\nfunction getEventHost (e) {\n  // on touchend event, we have to use `e.changedTouches`\n  // see http://stackoverflow.com/questions/7192563/touchend-event-properties\n  // see https://github.com/bevacqua/dragula/issues/34\n  if (e.targetTouches && e.targetTouches.length) {\n    return e.targetTouches[0];\n  }\n  if (e.changedTouches && e.changedTouches.length) {\n    return e.changedTouches[0];\n  }\n  return e;\n}\n\nfunction getCoord (coord, e) {\n  var host = getEventHost(e);\n  var missMap = {\n    pageX: 'clientX', // IE8\n    pageY: 'clientY' // IE8\n  };\n  if (coord in missMap && !(coord in host) && missMap[coord] in host) {\n    coord = missMap[coord];\n  }\n  return host[coord];\n}\n\nvar dragula_1 = dragula;\n\nvar joinHtml = \"<template>\\r\\n    <div class=\\\"box\\\">\\r\\n        <div class=\\\"columns\\\">\\r\\n            <div class=\\\"column is-narrow is-hidden-touch\\\">\\r\\n                <span class=\\\"drag\\\"></span>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <p class=\\\"has-text-weight-bold\\\">Message</p>\\r\\n            </div>\\r\\n            <div class=\\\"column\\\">\\r\\n                <textarea class=\\\"textarea is-small is-fluid\\\" data-target=\\\"message\\\"></textarea>\\r\\n            </div>\\r\\n            <div class=\\\"column is-3\\\">\\r\\n                <details>\\r\\n                    <summary>More options</summary>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <p class=\\\"has-text-weight-bold\\\">Player is </p>\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <select data-target=\\\"group\\\" class=\\\"select is-small\\\">\\r\\n                                <option value=\\\"all\\\">anyone</option>\\r\\n                                <option value=\\\"staff\\\">a staff member</option>\\r\\n                                <option value=\\\"mod\\\">a mod</option>\\r\\n                                <option value=\\\"admin\\\">an admin</option>\\r\\n                                <option value=\\\"owner\\\">the owner</option>\\r\\n                            </select>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <p class=\\\"has-text-weight-bold\\\">Player is not </p>\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <select data-target=\\\"not_group\\\" class=\\\"select is-small\\\">\\r\\n                                <option value=\\\"nobody\\\">nobody</option>\\r\\n                                <option value=\\\"staff\\\">a staff member</option>\\r\\n                                <option value=\\\"mod\\\">a mod</option>\\r\\n                                <option value=\\\"admin\\\">an admin</option>\\r\\n                                <option value=\\\"owner\\\">the owner</option>\\r\\n                            </select>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <input type=\\\"number\\\" class=\\\"input is-small\\\" value=\\\"0\\\" data-target=\\\"joins_low\\\" min=\\\"0\\\">\\r\\n                            <span class=\\\"has-text-weight-bold\\\"> &le; player joins &le; </span>\\r\\n                            <input type=\\\"number\\\" class=\\\"input is-small\\\" value=\\\"9999\\\" data-target=\\\"joins_high\\\">\\r\\n                        </div>\\r\\n                    </div>\\r\\n                </details>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <button class=\\\"button is-small is-danger is-outlined\\\" data-do=\\\"delete\\\">Delete</button>\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n</template>\\r\\n\\r\\n<div class=\\\"container is-widescreen\\\">\\r\\n    <section class=\\\"section is-small\\\">\\r\\n        <span class=\\\"button is-primary is-adding-message\\\">+</span>\\r\\n        <h3 class=\\\"title is-4\\\">Join Messages</h3>\\r\\n        <ul>\\r\\n            <li>These messages will be checked when a player joins the server.</li>\\r\\n            <li>{{NAME}}, {{Name}}, and {{name}} in the message will be replaced with the user's name.</li>\\r\\n        </ul>\\r\\n    </section>\\r\\n    <div class=\\\"messages-container\\\"></div>\\r\\n</div>\\r\\n\";\n\nvar leaveHtml = \"<template>\\r\\n    <div class=\\\"box\\\">\\r\\n        <div class=\\\"columns\\\">\\r\\n            <div class=\\\"column is-narrow is-hidden-touch\\\">\\r\\n                <span class=\\\"drag\\\"></span>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <p class=\\\"has-text-weight-bold\\\">Message</p>\\r\\n            </div>\\r\\n            <div class=\\\"column\\\">\\r\\n                <textarea class=\\\"textarea is-small is-fluid\\\" data-target=\\\"message\\\"></textarea>\\r\\n            </div>\\r\\n            <div class=\\\"column is-3\\\">\\r\\n                <details>\\r\\n                    <summary>More options</summary>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <p class=\\\"has-text-weight-bold\\\">Player is </p>\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <select data-target=\\\"group\\\" class=\\\"select is-small\\\">\\r\\n                                <option value=\\\"all\\\">anyone</option>\\r\\n                                <option value=\\\"staff\\\">a staff member</option>\\r\\n                                <option value=\\\"mod\\\">a mod</option>\\r\\n                                <option value=\\\"admin\\\">an admin</option>\\r\\n                                <option value=\\\"owner\\\">the owner</option>\\r\\n                            </select>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <p class=\\\"has-text-weight-bold\\\">Player is not </p>\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <select data-target=\\\"not_group\\\" class=\\\"select is-small\\\">\\r\\n                                <option value=\\\"nobody\\\">nobody</option>\\r\\n                                <option value=\\\"staff\\\">a staff member</option>\\r\\n                                <option value=\\\"mod\\\">a mod</option>\\r\\n                                <option value=\\\"admin\\\">an admin</option>\\r\\n                                <option value=\\\"owner\\\">the owner</option>\\r\\n                            </select>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <input type=\\\"number\\\" class=\\\"input is-small\\\" value=\\\"0\\\" data-target=\\\"joins_low\\\" min=\\\"0\\\">\\r\\n                            <span class=\\\"has-text-weight-bold\\\"> &le; player joins &le; </span>\\r\\n                            <input type=\\\"number\\\" class=\\\"input is-small\\\" value=\\\"9999\\\" data-target=\\\"joins_high\\\">\\r\\n                        </div>\\r\\n                    </div>\\r\\n                </details>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <button class=\\\"button is-small is-danger is-outlined\\\" data-do=\\\"delete\\\">Delete</button>\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n</template>\\r\\n\\r\\n<div class=\\\"container is-widescreen\\\">\\r\\n    <section class=\\\"section is-small\\\">\\r\\n        <span class=\\\"button is-primary is-adding-message\\\">+</span>\\r\\n        <h3 class=\\\"title is-4\\\">Leave Messages</h3>\\r\\n        <ul>\\r\\n            <li>These messages will be checked when a player leaves the server.</li>\\r\\n            <li>{{NAME}}, {{Name}}, and {{name}} in the message will be replaced with the user's name.</li>\\r\\n        </ul>\\r\\n    </section>\\r\\n    <div class=\\\"messages-container\\\"></div>\\r\\n</div>\\r\\n\";\n\nvar triggerHtml = \"<template>\\r\\n    <div class=\\\"box\\\">\\r\\n        <div class=\\\"columns\\\">\\r\\n            <div class=\\\"column is-narrow is-hidden-touch\\\">\\r\\n                <span class=\\\"drag\\\"></span>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <p class=\\\"has-text-weight-bold\\\">Trigger</p>\\r\\n            </div>\\r\\n            <div class=\\\"column is-2-desktop\\\">\\r\\n                <input class=\\\"input is-small\\\" data-target=\\\"trigger\\\">\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <p class=\\\"has-text-weight-bold\\\">Message</p>\\r\\n            </div>\\r\\n            <div class=\\\"column\\\">\\r\\n                <textarea class=\\\"textarea is-small is-fluid\\\" data-target=\\\"message\\\"></textarea>\\r\\n            </div>\\r\\n            <div class=\\\"column is-3\\\">\\r\\n                <details>\\r\\n                    <summary>More options</summary>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <p class=\\\"has-text-weight-bold\\\">Player is </p>\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <select data-target=\\\"group\\\" class=\\\"select is-small\\\">\\r\\n                                <option value=\\\"all\\\">anyone</option>\\r\\n                                <option value=\\\"staff\\\">a staff member</option>\\r\\n                                <option value=\\\"mod\\\">a mod</option>\\r\\n                                <option value=\\\"admin\\\">an admin</option>\\r\\n                                <option value=\\\"owner\\\">the owner</option>\\r\\n                            </select>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <p class=\\\"has-text-weight-bold\\\">Player is not </p>\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <select data-target=\\\"not_group\\\" class=\\\"select is-small\\\">\\r\\n                                <option value=\\\"nobody\\\">nobody</option>\\r\\n                                <option value=\\\"staff\\\">a staff member</option>\\r\\n                                <option value=\\\"mod\\\">a mod</option>\\r\\n                                <option value=\\\"admin\\\">an admin</option>\\r\\n                                <option value=\\\"owner\\\">the owner</option>\\r\\n                            </select>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <input type=\\\"number\\\" class=\\\"input is-small\\\" value=\\\"0\\\" data-target=\\\"joins_low\\\" min=\\\"0\\\">\\r\\n                            <span class=\\\"has-text-weight-bold\\\"> &le; player joins &le; </span>\\r\\n                            <input type=\\\"number\\\" class=\\\"input is-small\\\" value=\\\"9999\\\" data-target=\\\"joins_high\\\">\\r\\n                        </div>\\r\\n                    </div>\\r\\n                </details>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <button class=\\\"button is-small is-danger is-outlined\\\" data-do=\\\"delete\\\">Delete</button>\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n</template>\\r\\n\\r\\n<div class=\\\"container is-widescreen\\\">\\r\\n    <section class=\\\"section is-small\\\">\\r\\n        <span class=\\\"button is-primary is-adding-message\\\" title=\\\"Add trigger message\\\">+</span>\\r\\n        <h3 class=\\\"title is-4\\\">Triggers</h3>\\r\\n        <ul>\\r\\n            <li>The trigger will be checked against chat messages, if it matches, the message will be sent.</li>\\r\\n            <li>Triggers are case-insensitive.</li>\\r\\n            <li>{{NAME}}, {{Name}}, and {{name}} in the message will be replaced with the user's name.</li>\\r\\n            <li><code>*</code> will be treated as a wildcard.</li>\\r\\n            <li>Triggers are matched in order, if more than the max number are matched, later triggers will not be sent.</li>\\r\\n            <li>Change the maximum number of responses under settings.</li>\\r\\n        </ul>\\r\\n    </section>\\r\\n\\r\\n    <div class=\\\"messages-container\\\"></div>\\r\\n</div>\\r\\n\";\n\nvar annHtml = \"<template>\\r\\n    <div class=\\\"box\\\">\\r\\n        <div class=\\\"columns\\\">\\r\\n            <div class=\\\"column is-narrow is-hidden-touch\\\">\\r\\n                <span class=\\\"drag\\\"></span>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <p class=\\\"has-text-weight-bold\\\">Message</p>\\r\\n            </div>\\r\\n            <div class=\\\"column\\\">\\r\\n                <textarea class=\\\"textarea is-small is-fluid\\\" data-target=\\\"message\\\"></textarea>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <button class=\\\"button is-small is-danger is-outlined\\\" data-do=\\\"delete\\\">Delete</button>\\r\\n            </div>\\r\\n        </div>\\r\\n        <div>\\r\\n            Wait X minutes...\\r\\n        </div>\\r\\n    </div>\\r\\n</template>\\r\\n\\r\\n<div class=\\\"container is-widescreen\\\">\\r\\n    <section class=\\\"section is-small\\\">\\r\\n        <span class=\\\"button is-primary is-adding-message\\\">+</span>\\r\\n        <h3 class=\\\"title is-4\\\">Announcements</h3>\\r\\n        <ul>\\r\\n            <li>These are sent according to a regular schedule.</li>\\r\\n            <li>If you have one announcement, it is sent every X minutes, if you have two, then the first is sent at X minutes, and the second\\r\\n            is sent X minutes after the first. Change X in the settings tab. Once the bot reaches the end of the list, it starts over\\r\\n            at the top.</li>\\r\\n            <li>If no players are online when a message is scheduled to be sent, no message will be sent and the next message will reset to the first message.</li>\\r\\n        </ul>\\r\\n    </section>\\r\\n    <div class=\\\"messages-container\\\"></div>\\r\\n</div>\\r\\n\";\n\nfunction getElementWithClass(className, element) {\r\n    if (!element)\r\n        return;\r\n    return element.classList.contains(className) ? element : getElementWithClass(className, element.parentElement);\r\n}\r\nclass MessagesTab extends RemovableMessageHelper {\r\n    constructor({ name, ex, id }) {\r\n        super(id, ex);\r\n        this.setup = () => __awaiter(this, void 0, void 0, function* () {\r\n            this.insertHTML();\r\n            this.template = this.tab.querySelector('template');\r\n            this.root = this.tab.querySelector('.messages-container');\r\n            // Auto save messages\r\n            this.tab.addEventListener('input', () => this.save());\r\n            // Create a new message\r\n            let button = this.tab.querySelector('.button.is-primary');\r\n            button.addEventListener('click', () => this.addMessage());\r\n            // Deleting messages\r\n            this.tab.addEventListener('click', event => {\r\n                const target = event.target;\r\n                if (target.matches('[data-do=delete]')) {\r\n                    event.preventDefault();\r\n                    // Todo: Undo\r\n                    const row = getElementWithClass('box', target);\r\n                    if (!row)\r\n                        return;\r\n                    row.remove();\r\n                }\r\n                this.save();\r\n            });\r\n            // Moving up / down\r\n            const dragger = dragula_1([this.root], {\r\n                moves(_el, _container, handle) {\r\n                    return handle.classList.contains('drag');\r\n                }\r\n            });\r\n            dragger.on('drop', () => this.save());\r\n            dragger.on('drag', (el) => {\r\n                const details = el.querySelector('details');\r\n                if (details)\r\n                    details.open = false;\r\n            });\r\n            this.ex.storage.get(this.id, []).forEach(message => {\r\n                this.addMessage(message);\r\n            });\r\n        });\r\n        this.getMessages = () => {\r\n            let messages = [];\r\n            this.root.querySelectorAll('.box').forEach(element => {\r\n                let data = {};\r\n                element.querySelectorAll('[data-target]').forEach((input) => {\r\n                    let name = input.dataset['target'];\r\n                    if (!name)\r\n                        return;\r\n                    switch (input.getAttribute('type')) {\r\n                        case 'number':\r\n                            data[name] = +input.value;\r\n                            break;\r\n                        default:\r\n                            data[name] = input.value;\r\n                    }\r\n                });\r\n                messages.push(data);\r\n            });\r\n            return messages;\r\n        };\r\n        this.ui = ex.bot.getExports('ui');\r\n        this.ex = ex;\r\n        this.tab = this.ui.addTab(name, 'messages');\r\n    }\r\n    remove() {\r\n        this.ui.removeTab(this.tab);\r\n    }\r\n    save() {\r\n        this.ex.storage.set(this.id, this.getMessages());\r\n    }\r\n}\r\nclass JoinTab extends MessagesTab {\r\n    constructor(ex) {\r\n        super({ name: 'Join', id: 'joinArr', ex });\r\n        this.insertHTML = () => {\r\n            this.tab.innerHTML = joinHtml;\r\n        };\r\n        this.addMessage = (msg = {}) => {\r\n            this.ui.buildTemplate(this.template, this.root, [\r\n                { selector: '[data-for=message-trim]', text: msg.message || '' },\r\n                { selector: '[data-target=message]', text: msg.message || '' },\r\n                { selector: '[data-target=joins_low]', value: msg.joins_low || 0 },\r\n                { selector: '[data-target=joins_high]', value: msg.joins_high || 9999 },\r\n                { selector: '[data-target=group]', value: msg.group || 'all' },\r\n                { selector: '[data-target=not_group]', value: msg.not_group || 'nobody' },\r\n            ]);\r\n        };\r\n    }\r\n}\r\nclass LeaveTab extends MessagesTab {\r\n    constructor(ex) {\r\n        super({ name: 'Leave', id: 'leaveArr', ex });\r\n        this.insertHTML = () => {\r\n            this.tab.innerHTML = leaveHtml;\r\n        };\r\n        this.addMessage = (msg = {}) => {\r\n            this.ui.buildTemplate(this.template, this.root, [\r\n                { selector: '[data-for=message-trim]', text: msg.message || '' },\r\n                { selector: '[data-target=message]', text: msg.message || '' },\r\n                { selector: '[data-target=joins_low]', value: msg.joins_low || 0 },\r\n                { selector: '[data-target=joins_high]', value: msg.joins_high || 9999 },\r\n                { selector: '[data-target=group]', value: msg.group || 'all' },\r\n                { selector: '[data-target=not_group]', value: msg.not_group || 'nobody' }\r\n            ]);\r\n        };\r\n    }\r\n}\r\nclass TriggerTab extends MessagesTab {\r\n    constructor(ex) {\r\n        super({ name: 'Trigger', id: 'triggerArr', ex });\r\n        this.insertHTML = () => {\r\n            this.tab.innerHTML = triggerHtml;\r\n        };\r\n        this.addMessage = (msg = {}) => {\r\n            this.ui.buildTemplate(this.template, this.root, [\r\n                { selector: '[data-target=message]', text: msg.message || '' },\r\n                { selector: '[data-target=trigger]', value: msg.trigger || '' },\r\n                { selector: '[data-target=joins_low]', value: msg.joins_low || 0 },\r\n                { selector: '[data-target=joins_high]', value: msg.joins_high || 9999 },\r\n                { selector: '[data-target=group]', value: msg.group || 'all' },\r\n                { selector: '[data-target=not_group]', value: msg.not_group || 'nobody' }\r\n            ]);\r\n        };\r\n    }\r\n}\r\nclass AnnouncementTab extends MessagesTab {\r\n    constructor(ex) {\r\n        super({ name: 'Announcements', id: 'announcementArr', ex });\r\n        this.insertHTML = () => {\r\n            this.tab.innerHTML = annHtml;\r\n        };\r\n        this.addMessage = (msg = {}) => {\r\n            this.ui.buildTemplate(this.template, this.root, [\r\n                { selector: '[data-target=message]', text: msg.message || '' },\r\n            ]);\r\n        };\r\n    }\r\n}\n\nvar css = \".messages-container input[type=number] {\\r\\n    width: 5em;\\r\\n    font-size: 0.6rem;\\r\\n}\\r\\n\\r\\n.messages-container {\\r\\n    border-top: 1px solid #cccccc;\\r\\n    padding-top: 1em;\\r\\n}\\r\\n\\r\\n.messages-container .box {\\r\\n    padding: 0.7em;\\r\\n    padding-bottom: 0;\\r\\n    margin-bottom: 1em;\\r\\n}\\r\\n\\r\\n.messages-container .columns {\\r\\n    margin-bottom: 0;\\r\\n}\\r\\n\\r\\n.messages-container .drag::after {\\r\\n    content: \\\" \\\\2261\\\";\\r\\n}\\r\\n\\r\\n.messages-container .level-options {\\r\\n    display: flex;\\r\\n    flex-direction: row;\\r\\n    align-items: center;\\r\\n}\\r\\n@media screen and (max-width: 768px) {\\r\\n    .messages-container .level-options {\\r\\n        flex-wrap: wrap;\\r\\n    }\\r\\n}\\r\\n\\r\\n.messages-container summary {\\r\\n    outline: none;\\r\\n}\\r\\n\\r\\n.is-adding-message {\\r\\n    position: fixed;\\r\\n    left: 1em;\\r\\n    z-index: 10;\\r\\n}\\r\\n\\r\\n.messages-container p {\\r\\n    margin-right: 0.5em;\\r\\n}\\r\\n\\r\\n/** Copied from https://github.com/bevacqua/dragula/blob/b0e5c4/dist/dragula.css **/\\r\\n.gu-mirror {\\r\\n    position: fixed !important;\\r\\n    margin: 0 !important;\\r\\n    z-index: 9999 !important;\\r\\n    opacity: 0.8;\\r\\n    -ms-filter: \\\"progid:DXImageTransform.Microsoft.Alpha(Opacity=80)\\\";\\r\\n    filter: alpha(opacity=80);\\r\\n}\\r\\n.gu-hide {\\r\\n    display: none !important;\\r\\n}\\r\\n.gu-unselectable {\\r\\n    -webkit-user-select: none !important;\\r\\n    -moz-user-select: none !important;\\r\\n    -ms-user-select: none !important;\\r\\n    user-select: none !important;\\r\\n}\\r\\n.gu-transit {\\r\\n    opacity: 0.2;\\r\\n    -ms-filter: \\\"progid:DXImageTransform.Microsoft.Alpha(Opacity=20)\\\";\\r\\n    filter: alpha(opacity=20);\\r\\n}\\r\\n\";\n\nMessageBot.registerExtension('messages', function (ex, world) {\r\n    let listeners = [];\r\n    ex.remove = () => listeners.forEach(l => l.remove());\r\n    let hasLoaded = false;\r\n    let delayLoad = () => {\r\n        if (hasLoaded)\r\n            return;\r\n        hasLoaded = true;\r\n        let timeout = setTimeout(() => {\r\n            listeners = [\r\n                new JoinListener(ex),\r\n                new LeaveListener(ex),\r\n                new TriggerListener(ex),\r\n                new AnnouncementListener(ex),\r\n            ];\r\n        }, 500);\r\n        listeners = [{\r\n                remove: () => clearTimeout(timeout)\r\n            }];\r\n    };\r\n    world.onJoin.one(delayLoad);\r\n    world.onLeave.one(delayLoad);\r\n    world.onMessage.one(delayLoad);\r\n    // Loaded in a browser?\r\n    if (ex.bot.getExports('ui')) {\r\n        let style = document.head.appendChild(document.createElement('style'));\r\n        style.innerHTML = css;\r\n        let ui = ex.bot.getExports('ui');\r\n        ui.addTabGroup('Messages', 'messages');\r\n        let tabs = [\r\n            new JoinTab(ex),\r\n            new LeaveTab(ex),\r\n            new TriggerTab(ex),\r\n            new AnnouncementTab(ex),\r\n        ];\r\n        tabs.forEach(tab => tab.setup());\r\n        listeners = listeners.concat(...tabs, { remove: () => style.remove() }, { remove: () => ui.removeTabGroup('messages') });\r\n    }\r\n});\n","import { MessageBot } from '@bhmb/bot';\n\nfunction history(input) {\r\n    let history = [];\r\n    let current = 0;\r\n    function addToHistory(message) {\r\n        history.push(message);\r\n        while (history.length > 100) {\r\n            history.shift();\r\n        }\r\n        current = history.length;\r\n    }\r\n    function addIfNew(message) {\r\n        if (message != history.slice(-1).pop()) {\r\n            addToHistory(message);\r\n        }\r\n        else {\r\n            current = history.length;\r\n        }\r\n    }\r\n    input.addEventListener('keydown', event => {\r\n        if (event.key == 'ArrowUp') {\r\n            if (input.value.length && current == history.length) {\r\n                addToHistory(input.value);\r\n                current--;\r\n            }\r\n            if (history.length && current) {\r\n                input.value = history[--current];\r\n            }\r\n        }\r\n        else if (event.key == 'ArrowDown') {\r\n            if (history.length > current + 1) {\r\n                input.value = history[++current];\r\n            }\r\n            else if (history.length == current + 1) {\r\n                input.value = '';\r\n                current = history.length;\r\n            }\r\n        }\r\n        else if (event.key == 'Enter') {\r\n            addIfNew(input.value);\r\n        }\r\n    });\r\n}\n\nvar html = \"<template>\\r\\n    <li>\\r\\n        <span>NAME</span>\\r\\n        <span>: Message</span>\\r\\n    </li>\\r\\n</template>\\r\\n<div id=\\\"console\\\">\\r\\n    <div class=\\\"chat\\\">\\r\\n        <ul></ul>\\r\\n    </div>\\r\\n    <div class=\\\"chat-control\\\">\\r\\n        <div class=\\\"field has-addons\\\">\\r\\n            <p class=\\\"control is-expanded\\\">\\r\\n                <input type=\\\"text\\\" class=\\\"input\\\" />\\r\\n            </p>\\r\\n            <p class=\\\"control\\\">\\r\\n                <button class=\\\"input button is-primary\\\">SEND</button>\\r\\n            </p>\\r\\n        </div>\\r\\n    </div>\\r\\n</div>\";\n\nvar css = \"#console .mod > span:first-child {\\r\\n    color: #05f529;\\r\\n}\\r\\n\\r\\n#console .admin > span:first-child {\\r\\n    color: #2b26bd;\\r\\n}\\r\\n\\r\\n#console .chat {\\r\\n    margin: 0 1em;\\r\\n    height: calc(100vh - 52px - 4.25em);\\r\\n    overflow-y: auto;\\r\\n}\\r\\n\\r\\n#console .chat-control {\\r\\n    position: fixed;\\r\\n    bottom: 0;\\r\\n    width: 100vw;\\r\\n    background: #fff;\\r\\n}\\r\\n\\r\\n#console .field {\\r\\n    margin: 1em;\\r\\n}\\r\\n\";\n\nMessageBot.registerExtension('console', function (ex, world) {\r\n    if (!ex.bot.getExports('ui')) {\r\n        throw new Error('This extension should only be loaded in a browser, and must be loaded after the UI is loaded.');\r\n    }\r\n    const ui = ex.bot.getExports('ui');\r\n    // Create the tab.\r\n    let style = document.head.appendChild(document.createElement('style'));\r\n    style.textContent = css;\r\n    let tab = ui.addTab('Console');\r\n    tab.innerHTML = html;\r\n    let chatUl = tab.querySelector('ul');\r\n    let chatContainer = chatUl.parentElement;\r\n    let template = tab.querySelector('template');\r\n    // Handle sending\r\n    let input = tab.querySelector('input');\r\n    function userSend() {\r\n        ex.bot.send(input.value);\r\n        input.value = '';\r\n    }\r\n    input.addEventListener('keyup', event => {\r\n        if (event.key == 'Enter') {\r\n            userSend();\r\n        }\r\n    });\r\n    // History module, used to be a separate extension\r\n    history(input);\r\n    tab.querySelector('button').addEventListener('click', userSend);\r\n    // Auto scroll when new chat is added to the page, unless we are scrolled up.\r\n    new MutationObserver(function (events) {\r\n        let total = chatUl.children.length;\r\n        // Determine how many messages have been added\r\n        let addedHeight = 0;\r\n        for (let i = total - events.length; i < total; i++) {\r\n            addedHeight += chatUl.children[i].clientHeight;\r\n        }\r\n        // If we were scrolled down already, stay scrolled down\r\n        if (chatContainer.scrollHeight - chatContainer.clientHeight - chatContainer.scrollTop == addedHeight) {\r\n            chatContainer.scrollTop = chatContainer.scrollHeight;\r\n        }\r\n        // Remove old messages if necessary\r\n        while (chatUl.children.length > 500) {\r\n            chatUl.children[0].remove();\r\n        }\r\n    }).observe(chatUl, { childList: true, subtree: true });\r\n    // Add a message to the page\r\n    function addPlayerMessage(player, message) {\r\n        if (!message.length)\r\n            return;\r\n        let messageClass = 'player';\r\n        if (player.isAdmin)\r\n            messageClass = 'admin';\r\n        if (player.isMod)\r\n            messageClass = 'mod';\r\n        ui.buildTemplate(template, chatUl, [\r\n            { selector: 'li', 'class': messageClass },\r\n            { selector: 'span:first-child', text: player.name },\r\n            { selector: 'span:last-child', text: ': ' + message }\r\n        ]);\r\n    }\r\n    function addGenericMessage(message) {\r\n        if (!message.length)\r\n            return;\r\n        let li = document.createElement('li');\r\n        li.textContent = message;\r\n        chatUl.appendChild(li);\r\n    }\r\n    // Export required functions\r\n    let consoleExports = {\r\n        log: (message) => addPlayerMessage(world.getPlayer('SERVER'), message)\r\n    };\r\n    ex.exports = consoleExports;\r\n    function logJoins(player) {\r\n        if (ex.storage.get('logJoinIps', true)) {\r\n            consoleExports.log(`${player.name} (${player.ip}) joined.`);\r\n        }\r\n        else {\r\n            consoleExports.log(`${player.name} joined.`);\r\n        }\r\n    }\r\n    world.onJoin.sub(logJoins);\r\n    function logLeaves(player) {\r\n        consoleExports.log(player.name + ' left');\r\n    }\r\n    world.onLeave.sub(logLeaves);\r\n    function logMessages({ player, message }) {\r\n        addPlayerMessage(player, message);\r\n    }\r\n    world.onMessage.sub(logMessages);\r\n    function logOther(message) {\r\n        if (ex.storage.get('logUnparsedMessages', true)) {\r\n            addGenericMessage(message);\r\n        }\r\n    }\r\n    world.onOther.sub(logOther);\r\n    ex.remove = function () {\r\n        ui.removeTab(tab);\r\n        style.remove();\r\n        world.onJoin.unsub(logJoins);\r\n        world.onLeave.unsub(logLeaves);\r\n        world.onMessage.unsub(logMessages);\r\n        world.onOther.unsub(logOther);\r\n    };\r\n});\n","import { MessageBot } from '@bhmb/bot'\r\nimport { UIExtensionExports } from '@bhmb/ui'\r\n\r\nimport html from './extensions.html'\r\n\r\ninterface ExtensionInfo {\r\n    user: string\r\n    id: string\r\n    package: string\r\n    title: string\r\n    description: string\r\n    env: string\r\n}\r\n\r\nconst flatten = <T>(arr: T[][]): T[] => arr.reduce((carry, item) => carry.concat(item), [])\r\n// const pluck = <T, K extends keyof T>(arr: T[], key: K) => arr.map(item => item[key])\r\n\r\nexport const defaultRepo = `https://gitcdn.xyz/cdn/Blockheads-Messagebot/Extensions/master/extensions.json`\r\n\r\nfunction supported(info: ExtensionInfo): boolean {\r\n    const env = info.env.toLocaleLowerCase()\r\n    return [\r\n        env.includes('all'),\r\n        env.includes('browser'),\r\n        (env.includes('mac') && env.includes('cloud')),\r\n    ].some(Boolean) && /\\.(m?js|es)/.test(info.package)\r\n}\r\n\r\nMessageBot.registerExtension('extensions', ex => {\r\n    const ui = ex.bot.getExports('ui') as UIExtensionExports\r\n    const tab = ui.addTab('Extensions')\r\n    tab.innerHTML = html\r\n\r\n    tab.addEventListener('click', event => {\r\n        const target = event.target as HTMLElement\r\n        if (target.tagName != 'A') return\r\n        const id = target.getAttribute('ext_id')\r\n        if (!id) return\r\n\r\n        if (target.textContent == 'Install') {\r\n            load(id)\r\n        } else {\r\n            removeExtension(id)\r\n        }\r\n    })\r\n\r\n    ex.remove = () => {\r\n        throw new Error('This extension cannot be removed.')\r\n    }\r\n\r\n    function addExtension(id: string) {\r\n        try {\r\n            ex.bot.addExtension(id)\r\n            ex.storage.with<string[]>('autoload', [], ids => {\r\n                if (!ids.includes(id)) ids.push(id)\r\n            })\r\n            const button = tab.querySelector(`a[ext_id=\"${id}\"]`) as HTMLElement | null\r\n            if (button) button.textContent = 'Remove'\r\n        } catch (error) {\r\n            ui.notify('Error adding extension: ' + error)\r\n            try {\r\n                ex.bot.removeExtension(id, false)\r\n            } catch {}\r\n        }\r\n    }\r\n\r\n    function removeExtension(id: string) {\r\n        try {\r\n            ex.bot.removeExtension(id, true)\r\n            ex.storage.with<string[]>('autoload', [], ids => {\r\n                if (ids.includes(id)) ids.splice(ids.indexOf(id), 1)\r\n            })\r\n            const button = tab.querySelector(`a[ext_id=\"${id}\"]`) as HTMLElement | null\r\n            if (button) button.textContent = 'Install'\r\n        } catch (error) {\r\n            ui.notify('Error removing extension: ' + error)\r\n        }\r\n    }\r\n\r\n    function reloadExtension(id : string) {\r\n        //Does it exist as an extension we can reload?\r\n        const info = extensionMap.get(id)\r\n        if (!info) {\r\n            console.warn('Could not reload unknown ID:', id)\r\n            return\r\n        }\r\n        ex.bot.removeExtension(id, false)\r\n        MessageBot.deregisterExtension(id)\r\n        shouldLoad.add(id)\r\n        const script = document.head!.appendChild(document.createElement('script'))\r\n        script.src = info.package\r\n    }\r\n    ex.exports.reloadExtension = reloadExtension\r\n\r\n    // Load listener\r\n    const shouldLoad = new Set<string>()\r\n    MessageBot.extensionRegistered.sub(id => {\r\n        // If in developer mode, autoload unconditionally\r\n        if (ex.storage.get('devMode', false)) {\r\n            if (ex.bot.getExports(id)) ex.bot.removeExtension(id, false)\r\n            addExtension(id)\r\n        } else if (shouldLoad.has(id)) {\r\n            shouldLoad.delete(id)\r\n            addExtension(id)\r\n        }\r\n    })\r\n\r\n    const extensionMap = new Map<string, ExtensionInfo>()\r\n    function load(id: string) {\r\n        const info = extensionMap.get(id)\r\n        if (!info) {\r\n            console.warn('Could not load unknown ID:', id)\r\n            return\r\n        }\r\n        if (MessageBot.extensions.includes(id)) {\r\n            addExtension(id)\r\n        } else {\r\n            shouldLoad.add(id)\r\n            const script = document.head!.appendChild(document.createElement('script'))\r\n            script.src = info.package\r\n        }\r\n    }\r\n\r\n    // Load any extension repos\r\n    // Repos listed first should have priority for duplicate ids\r\n    const repos = ex.storage.get('repos', defaultRepo).split(/\\r?\\n/).reverse()\r\n    const repoRequests = repos.map(repo => fetch(repo).then(r => r.json()))\r\n    Promise.all(repoRequests)\r\n        .then((responses: ExtensionInfo[][]) => {\r\n            flatten(responses).filter(supported).forEach(extension => {\r\n                extensionMap.set(extension.id, extension)\r\n            })\r\n        })\r\n        .then(() => {\r\n            // Load those extensions which should be autoloaded\r\n            ex.storage.get<string[]>('autoload', []).forEach(load)\r\n            createPage()\r\n        }).catch(error => {\r\n            //In the scenario an extension repo fails to load.\r\n            console.error(error)\r\n            ui.notify('An extension repo has failed to load.')\r\n        })\r\n\r\n    function createPage() {\r\n        for (const extension of extensionMap.values()) {\r\n            ui.buildTemplate(\r\n                tab.querySelector('template') as HTMLTemplateElement,\r\n                tab.querySelector('tbody') as HTMLElement,\r\n                [\r\n                    { selector: '[data-for=title]', text: extension.title },\r\n                    { selector: '[data-for=description]', text: extension.description },\r\n                    { selector: '[data-for=author]', text: extension.user },\r\n                    { selector: 'a', ext_id: extension.id },\r\n                ]\r\n            )\r\n        }\r\n    }\r\n})\r\n","export class MessageBotExtension {\n    /**\n     * Creates a new extension.\n     * @param id the extension id\n     * @param bot the bot that this extension is loaded from\n     */\n    constructor(id, bot) {\n        this.bot = bot;\n        /**\n         * Any exports that other extensions may call.\n         */\n        this.exports = {};\n        this.storage = bot.storage.prefix(id);\n        this.world = bot.world;\n    }\n    /**\n     * Removes the extension, listeners and ui should be removed here. Stored settings should not be removed.\n     */\n    remove() { }\n    /**\n     * Removes the extension. All listeners should be removed here.\n     */\n    uninstall() {\n        this.remove();\n        this.storage.clear();\n    }\n}\n//# sourceMappingURL=extension.js.map","/**\n * An event which can be subscribed to and dispatched\n */\nexport class SimpleEvent {\n    constructor() {\n        this.subscribers = [];\n    }\n    /**\n     * Subscribe to the event.\n     * @param listener The listener which will be called when the event is dispatched.\n     */\n    sub(listener) {\n        this.subscribers.push({ listener, once: false });\n    }\n    /**\n     * Unsubscribe from the event.\n     * @param listener The listener to remove.\n     */\n    unsub(listener) {\n        let index = this.subscribers.findIndex(sub => listener == sub.listener);\n        if (index != -1) {\n            this.subscribers.splice(index, 1);\n        }\n    }\n    /**\n     * Subscribes to the event only once.\n     * @param listener The listener which will be called when the event is dispatched.\n     */\n    one(listener) {\n        this.subscribers.push({ listener, once: true });\n    }\n    /**\n     * Dispatches an event, calling all listeners.\n     * @param arg the argument to call listeners with.\n     */\n    dispatch(arg) {\n        this.subscribers.forEach(({ listener, once }) => {\n            if (once)\n                this.unsub(listener);\n            listener(arg);\n        });\n    }\n    /**\n     * A helper to avoid exposing undesirable events.\n     */\n    asEvent() {\n        let that = this;\n        return {\n            sub(listener) {\n                return that.sub(listener);\n            },\n            one(listener) {\n                return that.one(listener);\n            },\n            unsub(listener) {\n                return that.unsub(listener);\n            },\n        };\n    }\n}\n//# sourceMappingURL=events.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { SimpleEvent } from './events';\n/**\n * Internal class used by the [[World]] class to watch chat.\n * @hidden\n */\nexport class ChatWatcher {\n    /**\n     * Creates a new ChatWatcher\n     * @param api the api to be used to communicate with chat\n     * @param online a shared array with the host world class that this class keeps up to date.\n     */\n    constructor(api, online) {\n        this.api = api;\n        this.online = online;\n        this._onMessage = new SimpleEvent();\n        this._onJoin = new SimpleEvent();\n        this._onLeave = new SimpleEvent();\n        this._onOther = new SimpleEvent();\n        this.timeoutId = null;\n        /**\n         * Parses a chat message, firing the appropriate events if required.\n         */\n        this.parse = (message) => {\n            let parseError = () => {\n                this._onOther.dispatch(message);\n            };\n            if (/^[^a-z]+ - Player Connected /.test(message)) {\n                try {\n                    let [, name, ip] = message.match(/Connected ([^a-z]{3,}) \\| ([\\d.]+) \\| .{32}$/);\n                    if (!this.online.includes(name)) {\n                        this.online.includes(name) || this.online.push(name);\n                        this._onJoin.dispatch({ name, ip });\n                        return;\n                    }\n                }\n                catch (_) { }\n                return parseError();\n            }\n            if (/^[^a-z]+ - Player Disconnected /.test(message)) {\n                try {\n                    let [, name] = message.match(/Disconnected ([^a-z]{3,})$/);\n                    if (this.online.includes(name)) {\n                        this.online.splice(this.online.indexOf(name), 1);\n                        this._onLeave.dispatch(name);\n                        return;\n                    }\n                }\n                catch (_) { }\n                return parseError();\n            }\n            if (message.slice(0, 18).includes(': ')) {\n                let name = this.getUser(message);\n                if (name) {\n                    message = message.substr(name.length + 2);\n                    if (name == 'SERVER' && message.startsWith('/')) {\n                        return parseError();\n                    }\n                    this._onMessage.dispatch({ name, message });\n                    return;\n                }\n            }\n            return parseError();\n        };\n        /**\n         * Continually checks chat for new messages\n         * @param lastId the ID to pass to the API to get only most recent messages.\n         */\n        this.checkChat = (lastId) => __awaiter(this, void 0, void 0, function* () {\n            try {\n                let { log, nextId } = yield this.api.getMessages(lastId);\n                if (this.timeoutId == null)\n                    return;\n                log.forEach(this.parse);\n                this.timeoutId = setTimeout(this.checkChat, 5000, nextId);\n            }\n            catch (_) {\n                // Network error, wait 30 seconds before retrying\n                this.timeoutId = setTimeout(this.checkChat, 30000, 0);\n                return;\n            }\n        });\n    }\n    /**\n     * Event which fires when a player joins the server.\n     */\n    get onJoin() {\n        return this._onJoin.asEvent();\n    }\n    /**\n     * Event which fires when a player leaves the server.\n     */\n    get onLeave() {\n        return this._onLeave.asEvent();\n    }\n    /**\n     * Event which fires when a player sends a message in chat.\n     */\n    get onMessage() {\n        return this._onMessage.asEvent();\n    }\n    /**\n     * Event which fires when a chat message cannot be parsed as a message, join, or leave.\n     */\n    get onOther() {\n        return this._onOther.asEvent();\n    }\n    /**\n     * True if the watcher is currently running, otherwise false.\n     */\n    get running() {\n        return this.timeoutId != null;\n    }\n    /**\n     * Starts the listener. Calling multiple times will not result in multiple listeners being started.\n     */\n    start() {\n        if (this.timeoutId)\n            this.stop();\n        this.timeoutId = setTimeout(this.checkChat, 0, 0);\n    }\n    /**\n     * Stops the listener if it is running. If not running, does nothing.\n     */\n    stop() {\n        if (this.timeoutId)\n            clearTimeout(this.timeoutId);\n        this.timeoutId = null;\n    }\n    /**\n     * Parses a message to extract a player name.\n     * @param message the message to extract a name from.\n     */\n    getUser(message) {\n        for (let i = 18; i > 4; i--) {\n            let possibleName = message.substring(0, message.lastIndexOf(': ', i));\n            if (this.online.includes(possibleName) || possibleName == 'SERVER') {\n                return possibleName;\n            }\n        }\n        // Player is most likely offline\n        if (/[^a-z]{3,16}: /.test(message))\n            return message.substring(0, message.lastIndexOf(': ', 18));\n        // Invalid name\n        return '';\n    }\n}\n//# sourceMappingURL=chatWatcher.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { Player } from './player';\nimport { ChatWatcher } from './chatWatcher';\nimport { SimpleEvent } from './events';\nimport { updateLists } from './updateLists';\nconst cloneDate = (d) => new Date(d.getTime());\nconst PLAYERS_KEY = 'players';\nconst LAST_UPDATE_KEY = 'lastPlayersUpdate';\nexport class World {\n    constructor(api, storage) {\n        this._cache = {};\n        this._events = {\n            onJoin: new SimpleEvent(),\n            onLeave: new SimpleEvent(),\n            onMessage: new SimpleEvent(),\n        };\n        this._online = [];\n        this._lists = { adminlist: [], modlist: [], whitelist: [], blacklist: [] };\n        this._commands = new Map();\n        /**\n         * The first time joins were updated from chat\n         * It is assumed that all joins from this point onwards have been counted.\n         */\n        this._firstChatUpdate = Date.now();\n        /**\n         * Gets an overview of the server info\n         */\n        this.getOverview = (refresh = false) => __awaiter(this, void 0, void 0, function* () {\n            if (!this._cache.overview || refresh) {\n                let overview = yield (this._cache.overview = this._api.getOverview());\n                // Add online players to the online list if they aren't already online\n                overview.online.forEach(name => this._online.includes(name) || this._online.push(name));\n                // Make sure the owner has the owner flag set to true\n                this._storage.with(PLAYERS_KEY, {}, players => {\n                    players[overview.owner] = players[overview.owner] || { ip: '', ips: [], joins: 0 };\n                    players[overview.owner].owner = true;\n                });\n            }\n            let overview = yield this._cache.overview;\n            return Object.assign({}, overview, { created: cloneDate(overview.created), last_activity: cloneDate(overview.last_activity), credit_until: cloneDate(overview.credit_until), online: this.online });\n        });\n        /**\n         * Returns the current world status, will always make a request to the server.\n         */\n        this.getStatus = () => this._api.getStatus();\n        /**\n         * Gets the server's lists\n         */\n        this.getLists = (refresh = false) => {\n            if (!this._cache.lists || refresh) {\n                this._cache.lists = this._api.getLists().then(lists => this._lists = lists);\n            }\n            return this._cache.lists\n                .then(lists => ({\n                adminlist: [...lists.adminlist],\n                modlist: [...lists.modlist],\n                whitelist: [...lists.whitelist],\n                blacklist: [...lists.blacklist]\n            }));\n        };\n        /**\n         * Sets the server's lists and reloads the world lists if required.\n         *\n         * @param lists WorldLists one or more list to update. If a list is not provided it will not be changed.\n         * @return a promise which will resolve when the lists have been updated, or throw if an error occurred.\n         */\n        this.setLists = (lists) => __awaiter(this, void 0, void 0, function* () {\n            let currentLists = yield this.getLists();\n            yield this._api.setLists(Object.assign({}, currentLists, lists));\n            yield this.getLists(true);\n        });\n        /**\n         * Gets the server logs\n         *\n         * @param refresh if true, will get the latest logs, otherwise will returned the cached version.\n         */\n        this.getLogs = (refresh = false) => __awaiter(this, void 0, void 0, function* () {\n            if (!this._cache.logs || refresh) {\n                const updatePlayers = !this._cache.logs;\n                this._cache.logs = this._api.getLogs();\n                if (updatePlayers)\n                    yield this._updatePlayers();\n            }\n            let lines = yield this._cache.logs;\n            return lines.slice().map(line => (Object.assign({}, line, { timestamp: cloneDate(line.timestamp) })));\n        });\n        /**\n         * Sends the specified message, returns a promise that will reject if the send fails and resolve otherwise.\n         *\n         * @param message the message to send\n         */\n        this.send = (message) => {\n            if (message.startsWith('/'))\n                this._events.onMessage.dispatch({ player: this.getPlayer('SERVER'), message });\n            return this._api.send(message);\n        };\n        /**\n         * Gets a specific player by name\n         */\n        this.getPlayer = (name) => {\n            name = name.toLocaleUpperCase();\n            let players = this._storage.get(PLAYERS_KEY, {});\n            return new Player(name, players[name] || { ip: '', ips: [], joins: 0 }, this._lists);\n        };\n        /**\n         * Adds a listener for a single command, can be used when a command can be statically matched.\n         *\n         * @param command the command that the listener should be called for, case insensitive\n         * @param listener the function which should be called whenever the command is used\n         * @example\n         * world.addCommand('marco', () => { ex.bot.send('Polo!'); });\n         */\n        this.addCommand = (command, listener) => {\n            command = command.toLocaleUpperCase();\n            if (this._commands.has(command)) {\n                throw new Error(`The command \"${command}\" has already been added.`);\n            }\n            this._commands.set(command, listener);\n        };\n        /**\n         * Removes a listener for a command, if it exists.\n         *\n         * @param command the command for which the listener should be removed.\n         */\n        this.removeCommand = (command) => {\n            this._commands.delete(command.toLocaleUpperCase());\n        };\n        /**\n         * Starts the world, if it is not already started. Will not reject.\n         */\n        this.start = () => this._api.start();\n        /**\n         * Stops the world if it is running. Will not throw.\n         */\n        this.stop = () => this._api.stop();\n        /**\n         * Sends a restart request, if the world is offline no actions will be taken.\n         */\n        this.restart = () => this._api.restart();\n        /**\n         * Starts the internal chat watcher\n         */\n        this.startWatchingChat = () => this._chatWatcher.start();\n        /**\n         * Stops the internal chat watcher.\n         */\n        this.stopWatchingChat = () => this._chatWatcher.stop();\n        this._api = api;\n        this._storage = storage;\n        this._lastLogUpdate = storage.get(LAST_UPDATE_KEY, 0);\n        this._createWatcher();\n        this.getOverview(); // Sets the owner, gets initial online players\n        this.getLists(); // Loads the current server lists\n    }\n    /**\n     * Fires whenever a player joins the server\n     */\n    get onJoin() {\n        return this._events.onJoin.asEvent();\n    }\n    /**\n     * Fires whenever a player leaves the server.\n     */\n    get onLeave() {\n        return this._events.onLeave.asEvent();\n    }\n    /**\n     * Fires whenever a player or the server sends a message in chat.\n     * Includes messages starting with /\n     */\n    get onMessage() {\n        return this._events.onMessage.asEvent();\n    }\n    /**\n     * Fires whenever a message that cannot be parsed is encountered.\n     */\n    get onOther() {\n        // This class doesn't do anything with the onOther events, so just pass it through.\n        return this._chatWatcher.onOther;\n    }\n    /**\n     * Gets the currently online players\n     */\n    get online() {\n        return [...this._online];\n    }\n    /**\n     * Gets all players who have joined the server\n     */\n    get players() {\n        let players = this._storage.get(PLAYERS_KEY, {});\n        return Object.keys(players).map(this.getPlayer);\n    }\n    /**\n     * Internal init function\n     */\n    _createWatcher() {\n        let watcher = this._chatWatcher = new ChatWatcher(this._api, this._online);\n        watcher.onJoin.sub(arg => this._userJoin(arg));\n        watcher.onLeave.sub(name => this._events.onLeave.dispatch(this.getPlayer(name)));\n        watcher.onMessage.sub(({ name, message }) => {\n            const player = this.getPlayer(name);\n            this._events.onMessage.dispatch({ player, message });\n            updateLists(this._lists, player, message);\n        });\n        this.onMessage.sub(({ player, message }) => {\n            if (/^\\/[^ ]/.test(message)) {\n                const [, command, args] = message.match(/^\\/([^ ]+) ?(.*)$/);\n                const handler = this._commands.get(command.toLocaleUpperCase());\n                if (handler)\n                    handler(player, args);\n            }\n        });\n    }\n    _updatePlayers() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const lines = yield this.getLogs();\n            const { name } = yield this.getOverview();\n            for (const line of lines) {\n                if (line.timestamp.getTime() < this._lastLogUpdate)\n                    continue;\n                if (line.timestamp.getTime() > this._firstChatUpdate)\n                    continue;\n                if (!line.message.startsWith(`${name} - Player Connected`))\n                    continue;\n                const [, user, ip] = line.message.match(/Connected ([^a-z]{3,}) \\| ([\\d.]+) \\| .{32}$/);\n                this._recordJoin({ name: user, ip });\n            }\n        });\n    }\n    _recordJoin({ name, ip }) {\n        name = name.toLocaleUpperCase();\n        this._storage.with(PLAYERS_KEY, {}, players => {\n            const player = players[name] = players[name] || { ip, ips: [ip], joins: 0 };\n            player.joins++;\n            player.ip = ip;\n            if (!player.ips.includes(ip))\n                player.ips.push(ip);\n        });\n        // Prevent this join from being counted twice\n        this._storage.set(LAST_UPDATE_KEY, Date.now());\n    }\n    _userJoin({ name, ip }) {\n        this._recordJoin({ name, ip });\n        this._events.onJoin.dispatch(this.getPlayer(name));\n    }\n}\n//# sourceMappingURL=world.js.map","/**\n * The storage class used by the [[MessageBot]] class and all [[MessageBotExtension]] instances.\n */\nexport class Storage {\n    /**\n     * Utility method to use and automatically save a key\n     * @param key the key use when getting and setting the value\n     * @param fallback the fallback if the key doesn't exist\n     * @param callback the function to be called with the data, if the callback returns null or undefined, it is assumed that the value has been mutated and will be saved.\n     */\n    with(key, fallback, callback) {\n        let value = this.get(key, fallback);\n        let result = callback(value);\n        this.set(key, result == null ? value : result);\n    }\n}\n//# sourceMappingURL=storage.js.map","var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\n            t[p[i]] = s[p[i]];\n    return t;\n};\nimport { MessageBotExtension } from './extension';\nimport { World } from './world';\nimport { Player } from './player';\nimport { Storage } from './storage';\nimport { SimpleEvent } from './events';\nexport { MessageBotExtension, World, Player, Storage, SimpleEvent };\nlet registeredExtensions = new Map();\nlet extensionRegistered = new SimpleEvent();\nlet extensionDeregistered = new SimpleEvent();\nexport class MessageBot {\n    /**\n     *\n     * @param storage The storage instance to be used by the bot.\n     * @param info The world info that is used to create the API to interact with the world.\n     */\n    constructor(storage, info) {\n        this.storage = storage;\n        /**\n         * All loaded extension instances for this bot.\n         */\n        this._extensions = new Map();\n        if (!MessageBot.dependencies)\n            throw new Error('Dependencies must be set before creating this class.');\n        this.world = new World(new MessageBot.dependencies.Api(info), storage);\n    }\n    /**\n     * Registers an extension that can be loaded by instances of the bot.\n     * Note: If an extension has already been loaded from a previously registered initializer, it will not be overwritten.\n     * @param id the extension ID, will be normalized to lower case.\n     * @param initializer the function to be called to set up the extension.\n     */\n    static registerExtension(id, initializer) {\n        id = id.toLocaleLowerCase();\n        registeredExtensions.set(id, initializer);\n        extensionRegistered.dispatch(id);\n    }\n    /**\n     * Removes an extension initializer from the registry, can be used to prevent an extension from being loaded in multiple bots at once (generally a bad idea).\n     * @param id the id of the extension to deregister\n     */\n    static deregisterExtension(id) {\n        id = id.toLocaleLowerCase();\n        if (registeredExtensions.delete(id)) {\n            extensionDeregistered.dispatch(id);\n        }\n    }\n    /**\n     * An array of all registered extensions.\n     */\n    static get extensions() {\n        return [...registeredExtensions.keys()];\n    }\n    /**\n     * An array of currently loaded extension ids\n     */\n    get extensions() {\n        return [...this._extensions.keys()];\n    }\n    /**\n     * Shortcut for `MessageBot.dependencies.fetch`\n     */\n    get fetch() {\n        return MessageBot.dependencies.fetch;\n    }\n    /**\n     * Starts listening to chat.\n     */\n    start() {\n        this.world.startWatchingChat();\n    }\n    /**\n     * Gets the exports of an extension, returns undefined if the extension is not loaded.\n     * @param id the extension id to get exports from\n     */\n    getExports(id) {\n        let ex = this._extensions.get(id.toLocaleLowerCase());\n        if (ex)\n            return ex.exports;\n    }\n    /**\n     * Adds an extension to this bot. Calls the init function supplied when registering the extension.\n     * @param id the id of the registered extension to add.\n     */\n    addExtension(id) {\n        id = id.toLocaleLowerCase();\n        if (this._extensions.has(id))\n            throw new Error(`The ${id} extension has already been added.`);\n        let creator = registeredExtensions.get(id);\n        if (!creator)\n            throw new Error(`The ${id} extension has not been registered.`);\n        let ex = new MessageBotExtension(id, this);\n        this._extensions.set(id, ex);\n        creator.call(ex, ex, this.world);\n    }\n    /**\n     * Removes a currently loaded extension. Should not be used by published extensions unless\n     * the extension is an extension manager.\n     * @param id the id of the extension to remove\n     * @param uninstall whether or not the extension should be completely removed, or just unloaded.\n     */\n    removeExtension(id, uninstall) {\n        id = id.toLocaleLowerCase();\n        let ex = this._extensions.get(id);\n        if (!ex)\n            throw new Error(`The ${id} extension is not registered.`);\n        try {\n            if (uninstall) {\n                ex.uninstall();\n            }\n            else {\n                ex.remove();\n            }\n        }\n        finally {\n            this._extensions.delete(id);\n        }\n    }\n    /**\n     * Sends a message to the world for this bot, should usually be used in place of world.send.\n     *\n     * @param message the message to send\n     * @param params any variables to inject into the message. If `name` is provided, it will be available through {{NAME}}, {{Name}} and {{name}}\n     */\n    send(message, _a = {}) {\n        var params = __rest(_a, []);\n        // Common enough to be done here, set the name of the player up right.\n        if (params.name && params.name.length) {\n            let name = params.name.toLocaleLowerCase();\n            params = Object.assign({}, params, { name, Name: name[0].toLocaleUpperCase() + name.substr(1), NAME: name.toLocaleUpperCase() });\n        }\n        let safeKeyRegex = Object.keys(params)\n            .map(key => key.replace(/([.+?^=!:${}()|\\[\\]\\/\\\\])/g, '\\\\$1'))\n            .join('}}|{{');\n        // Don't bother replacing if nothing to search for\n        if (safeKeyRegex.length) {\n            message = message.replace(new RegExp(`{{${safeKeyRegex}}}`, 'g'), (key) => {\n                return params[key.substring(2, key.length - 2)];\n            });\n        }\n        this.world.send(message).catch(() => { });\n    }\n}\n/**\n * An event that fires whenever an extension is registered or re-registered.\n */\nMessageBot.extensionRegistered = extensionRegistered.asEvent();\n/**\n * An event that fires when an extension is deregistered, if it has been registered. Will not fire when an extension is re-registered.\n */\nMessageBot.extensionDeregistered = extensionDeregistered.asEvent();\n//# sourceMappingURL=index.js.map","import { MessageBot as Bot } from '@bhmb/bot'\r\n\r\n// Custom bot class to support splitting messages\r\n\r\nexport class MessageBot extends Bot implements Bot {\r\n    send(message: string, { ...params }: {[key: string]: string} = {}): void {\r\n        let messages: string[]\r\n        // Split the message if splitting is enabled.\r\n        if (this.storage.get('splitMessages', false)) {\r\n            messages = message.split(this.storage.get('splitToken', '<split>'))\r\n        } else {\r\n            messages = [message]\r\n        }\r\n\r\n        for (let msg of messages) {\r\n            super.send(msg, params)\r\n        }\r\n    }\r\n}","import { Storage as AStorage } from '@bhmb/bot'\r\n\r\nexport class Storage extends AStorage {\r\n    constructor(private head: string) {\r\n        super()\r\n        // For readability\r\n        this.head += '/'\r\n    }\r\n\r\n    get<T>(key: string, fallback: T): T {\r\n        // JSON.parse correctly handles null so it's fine to declare this as string.\r\n        const item = localStorage.getItem(this.head + key) as string\r\n        try {\r\n            const parsed = JSON.parse(item)\r\n            return parsed == null ? fallback : parsed\r\n        } catch {\r\n            return fallback\r\n        }\r\n    }\r\n\r\n    set(key: string, value: any): void {\r\n        localStorage.setItem(this.head + key, JSON.stringify(value))\r\n    }\r\n\r\n    clear(prefix: string = ''): void {\r\n        this.keys(prefix)\r\n            .forEach(key => localStorage.removeItem(this.head + key))\r\n    }\r\n\r\n    keys(prefix: string = ''): string[] {\r\n        return Object.keys(localStorage)\r\n            .filter(key => key.startsWith(this.head + prefix))\r\n            .map(key => key.substr(this.head.length))\r\n    }\r\n\r\n    prefix(prefix: string): AStorage {\r\n        return new Storage(this.head + prefix)\r\n    }\r\n}\r\n","import { MessageBot } from '@bhmb/bot'\r\nimport { UIExtensionExports } from '@bhmb/ui'\r\n\r\nimport html from './settings.html'\r\n\r\nimport { defaultRepo } from './extensions'\r\n\r\nconst settingDefaults: [string, string | number | boolean][] = [\r\n    // General\r\n    ['messages/announcementDelay', 10],\r\n    ['messages/maxResponses', 3],\r\n    ['console/logJoinIps', true],\r\n    ['console/logUnparsedMessages', true],\r\n    // Advanced\r\n    ['messages/regexTriggers', false],\r\n    ['messages/disableWhitespaceTrimming', false],\r\n    ['splitMessages', false],\r\n    ['splitToken', '<split>'],\r\n    ['extensions/devMode', false],\r\n    ['extensions/repos', defaultRepo],\r\n]\r\n\r\nMessageBot.registerExtension('settings', function (ex) {\r\n    const settingsRoot = ex.bot.storage\r\n    const ui = ex.bot.getExports('ui') as UIExtensionExports\r\n\r\n    const tab = ui.addTab('Settings')\r\n    tab.innerHTML = html\r\n\r\n    for (const [key, def] of settingDefaults) {\r\n        const el = tab.querySelector(`[data-target=\"${key}\"]`) as HTMLInputElement\r\n\r\n        if (typeof def == 'boolean') {\r\n            el.checked = settingsRoot.get(key, def)\r\n        } else {\r\n            el.value = String(settingsRoot.get(key, def))\r\n        }\r\n    }\r\n\r\n    tab.addEventListener('change', () => {\r\n        for (const [key, def] of settingDefaults) {\r\n            const el = tab.querySelector(`[data-target=\"${key}\"]`) as HTMLInputElement\r\n\r\n            if (typeof def == 'boolean') {\r\n                settingsRoot.set(key, el.checked)\r\n            } else if (typeof def == 'number') {\r\n                settingsRoot.set(key, +el.value)\r\n            } else {\r\n                settingsRoot.set(key, el.value)\r\n            }\r\n        }\r\n    })\r\n\r\n    function importBackup(backup: string) {\r\n        let parsed: { [k: string]: string }\r\n        try {\r\n            parsed = JSON.parse(backup)\r\n            if (parsed === null) {\r\n                throw new Error('Invalid backup')\r\n            }\r\n        } catch (e) {\r\n            ui.notify('Invalid backup code. No action taken.')\r\n            return\r\n        }\r\n\r\n        localStorage.clear()\r\n\r\n        Object.keys(parsed).forEach((key) => {\r\n            localStorage.setItem(key, parsed[key])\r\n        })\r\n\r\n        location.reload()\r\n    }\r\n\r\n    (tab.querySelector('[data-do=show_backup]') as HTMLElement).addEventListener('click', () => {\r\n        // Must be loaded in a browser, so safe to use localStorage\r\n        const backup = JSON.stringify(localStorage).replace(/</g, '&lt;')\r\n        ui.alert(`<p>Copy this to a safe place.</p><textarea class=\"textarea\">${backup}</textarea>`)\r\n    })\r\n\r\n    ;(tab.querySelector('[data-do=import_backup]') as HTMLElement).addEventListener('click', () => {\r\n        ui.prompt('Enter your backup code, this will reload the page:', result => {\r\n            if (result) {\r\n                importBackup(result)\r\n            }\r\n        })\r\n    })\r\n\r\n    ;(tab.querySelector('[data-do=download_backup]') as HTMLElement).addEventListener('click', () => {\r\n        const backup = JSON.stringify(localStorage, undefined, 4)\r\n\r\n        const element = document.createElement('a')\r\n        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(backup))\r\n        element.setAttribute('download', 'bot_backup.txt')\r\n\r\n        element.style.display = 'none'\r\n        document.body.appendChild(element)\r\n\r\n        element.click()\r\n\r\n        document.body.removeChild(element)\r\n    })\r\n\r\n    ;(tab.querySelector('[data-do=upload_backup]') as HTMLElement).addEventListener('click', () => {\r\n        if (!File || !FileReader || !FileList || !Blob) {\r\n            ui.notify(`It looks like your browser doesn't support this.`)\r\n            return\r\n        }\r\n\r\n        const input = document.createElement('input')\r\n        input.type = 'file'\r\n        input.addEventListener('change', () => {\r\n            if (!input.files || input.files[0].type != 'text/plain') {\r\n                ui.notify('Upload a text file.')\r\n                return\r\n            }\r\n\r\n            const reader = new FileReader()\r\n            reader.addEventListener('load', () => {\r\n                importBackup(reader.result as string)\r\n            })\r\n\r\n            reader.readAsText(input.files[0])\r\n        })\r\n\r\n        input.click()\r\n    })\r\n\r\n    ex.remove = function () {\r\n        ui.removeTab(tab)\r\n    }\r\n})\r\n","import { MessageBot as CustomBot } from './bot'\r\nimport { MessageBot, SimpleEvent } from '@bhmb/bot'\r\nimport { Api, getWorlds } from 'blockheads-cloud-api'\r\nimport { WorldInfo } from 'blockheads-api-interface'\r\nimport { Storage } from './storage'\r\nimport '@bhmb/ui'\r\nimport '@bhmb/messages'\r\nimport '@bhmb/console'\r\nimport './settings'\r\nimport './extensions'\r\n\r\nif ((window as any)['@bhmb/bot']) {\r\n    throw new Error('Bot already loaded.')\r\n}\r\n\r\n(window as any)['@bhmb/bot'] = { MessageBot, SimpleEvent }\r\nconst worldId: string = (window as any).worldId.toString()\r\n\r\nif (location.hostname != 'portal.theblockheads.net') {\r\n    if (confirm('You are not on the portal, go there now?')) {\r\n        location.assign('http://portal.theblockheads.net')\r\n    }\r\n}\r\n\r\nif (!worldId) {\r\n    alert('You must be on a world page to start the bot')\r\n    throw new Error('Bad page')\r\n}\r\n// Kill the original listener\r\n(window as any).pollChat = () => {}\r\n\r\nMessageBot.dependencies = { Api, getWorlds, fetch }\r\n\r\nconst info: WorldInfo = {\r\n    name: (document.querySelector('#title') as HTMLElement).textContent as string,\r\n    id: worldId\r\n}\r\n\r\nasync function main() {\r\n    const bot = new CustomBot(new Storage(`/${worldId}`), info)\r\n    bot.addExtension('ui')\r\n    bot.addExtension('console')\r\n    ;(document.querySelector('.nav-item') as HTMLElement).click()\r\n    bot.addExtension('messages')\r\n    bot.addExtension('settings')\r\n    bot.addExtension('extensions')\r\n\r\n    // Check to see if the bot is loaded already\r\n    const loadChecker = (event: StorageEvent) => {\r\n        if (event.key === 'load_indicator' + worldId && event.newValue === '1') {\r\n            localStorage.setItem('already_loaded' + worldId, '1')\r\n            localStorage.setItem('load_indicator' + worldId, '0')\r\n        }\r\n    }\r\n    const loadWarner = (event: StorageEvent) => {\r\n        if (event.key === 'already_loaded' + worldId && event.newValue === '1') {\r\n            localStorage.setItem('already_loaded' + worldId, '0')\r\n            bot.getExports('ui')!\r\n                .alert('Warning: The bot is already loaded in another tab. If you leave this tab open, your storage may be overwritten and messages may be sent twice.')\r\n        }\r\n    }\r\n    addEventListener('storage', loadChecker)\r\n    addEventListener('storage', loadWarner)\r\n    // Fire the event so that we will be warned if another tab is already opened\r\n    localStorage.setItem('load_indicator' + worldId, '1')\r\n    // Reset the load indicator so that if another tab isn't opened, we will get an event when it is opened.\r\n    localStorage.setItem('load_indicator' + worldId, '0')\r\n\r\n    bot.start()\r\n    await bot.world.start()\r\n    await bot.world.getLists(true)\r\n}\r\nmain()\r\n\r\n"],"names":["__rest","s","e","t","p","Object","prototype","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","rejected","result","done","then","apply","equalCaseInsensitive","a","b","localeCompare","undefined","sensitivity","arrayContainsAny","haystack","needles","some","item","needle","updateLists","lists","player","message","isAdmin","target","toLocaleUpperCase","replace","startsWith","addToList","adminlist","removeFromList","blacklist","modlist","removeFromLists","whitelist","unescapeHTML","html","map","lt","gt","amp","#39","quot","_","first","makeRequest","url","options","headers","X-Requested-With","method","request","root","assign","mode","credentials","redirect","requestJSON","r","json","requestPage","text","getWorlds","this","worlds","split","forEach","line","test","name","match","id","push","api","menuSlider","document","querySelector","toggleMenu","classList","toggle","el","querySelectorAll","addEventListener","tabs","Map","groups","container","getElementById","menuContainer","event","nav","tab","get","Array","from","children","child","remove","add","span","addTab","groupName","div","appendChild","createElement","parent","textContent","set","removeTab","content","entries","delete","addTabGroup","details","parentElement","summary","removeTabGroup","group","handleRule","rule","element","innerHTML","HTMLTextAreaElement","HTMLSelectElement","selected","keys","filter","key","includes","setAttribute","buildTemplate","template","rules","importNode","selector","console","warn","notify","displayTime","body","timeouts","setTimeout","clearTimeout","alertInstance","active","queue","modal","modalBody","modalFooter","addButton","button","styles","style","showAlert","buttons","callback","shift","isArray","buttonHandler","tagName","err","error","removeEventListener","alert","prompt","outerHTML","polyfill","head","window","parentNode","getAttribute","open","removeAttribute","checkJoins","joins","joins_low","joins_high","checkGroups","isInGroup","not_group","isStaff","isMod","isOwner","addEventEasy","type","fn","capturing","addEventHard","attachEvent","wrap","removeEventEasy","removeEventHard","listener","unwrap","detachEvent","fabricateEvent","model","eventmap_1","customEvent","detail","doc","createEvent","initEvent","createEventObject","dispatchEvent","fireEvent","wrapperFactory","originalEvent","commonjsGlobal","srcElement","preventDefault","returnValue","stopPropagation","cancelBubble","which","keyCode","wrapper","hardCache","find","splice","lookupClass","className","cached","cache","lastIndex","RegExp","start","end","addClass","current","rmClass","trim","dragula","initialContainers","isContainer","drake","containers","o","events","op","touchy","documentElement","grab","release","eventualMovements","startBecauseMouseMoved","movements","crossvent","preventGrabbed","destroy","_grabbed","_moveX","clientX","_moveY","clientY","whichMouseButton","metaKey","ctrlKey","context","canStart","isInput","focus","ignoreInputTextSelection","getCoord","doc$1","elementFromPoint","grabbed","offset","getOffset","_item","_offsetX","left","_offsetY","top","classes","_copy","renderMirrorImage","drag","dragging","_mirror","handle","getParent","invalid","source","moves","nextEl","canMove","manualStart","isCopy","cloneNode","emit","_source","_initialSibling","_currentSibling","invalidTarget","drop","ungrab","dropTarget","findDropTarget","getElementBehindPoint","copySortSource","removeOnSpill","cancel","removeChild","isInitialPlacement","cleanup","revert","reverts","arguments","revertOnSpill","initial","insertBefore","removeMirrorImage","rm","_renderTimer","_lastDropTarget","sibling","elementBehindCursor","immediate","getImmediateChild","reference","getReference","accepts","moved","x","y","changed","spillOver","spillOut","rect","getBoundingClientRect","width","getRectWidth","height","getRectHeight","mirrorContainer","after","horizontal","direction","len","copy","always","never","emitter","on","touch","mouseup","mousedown","mousemove","pointers","microsoft","navigator","pointerEnabled","msPointerEnabled","touches","getScroll","scrollProp","offsetProp","clientHeight","point","state","right","bottom","isEditable","contentEditable","nextElementSibling","nextSibling","nodeType","getEventHost","targetTouches","changedTouches","coord","host","missMap","pageX","pageY","getElementWithClass","contains","history","input","addToHistory","addIfNew","slice","pop","info","env","toLocaleLowerCase","Boolean","package","MessageBotExtension","[object Object]","bot","exports","storage","prefix","world","clear","Player","_name","_info","_lists","ip","ips","hasJoined","owner","isWhitelisted","isBanned","entry","substr","SimpleEvent","subscribers","once","index","findIndex","sub","arg","unsub","that","one","ChatWatcher","online","_onMessage","_onJoin","_onLeave","_onOther","timeoutId","parse","parseError","dispatch","getUser","checkChat","lastId","log","nextId","getMessages","onJoin","asEvent","onLeave","onMessage","onOther","running","stop","possibleName","substring","lastIndexOf","list","cloneDate","d","Date","getTime","World","_cache","_events","_online","_commands","_firstChatUpdate","now","getOverview","refresh","overview","_api","_storage","with","players","created","last_activity","credit_until","getStatus","getLists","setLists","currentLists","getLogs","logs","updatePlayers","_updatePlayers","timestamp","send","getPlayer","addCommand","command","has","Error","removeCommand","restart","startWatchingChat","_chatWatcher","stopWatchingChat","_lastLogUpdate","_createWatcher","watcher","_userJoin","args","handler","lines","user","_recordJoin","Storage","fallback","registeredExtensions","extensionRegistered","extensionDeregistered","MessageBot","_extensions","dependencies","Api","initializer","extensions","fetch","ex","creator","uninstall","_a","params","Name","NAME","safeKeyRegex","join","catch","Bot","messages","msg","super","LogParser","isValidLine","addLine","reverse","ts","raw","parser","page","getList","names","Set","makeSafe","encodeURIComponent","firstMatch","m","privacy","concat","link","pvp","password","size","status","response","worldStatus","AStorage","localStorage","getItem","parsed","JSON","setItem","stringify","removeItem","registerExtension","rel","href","RemovableMessageHelper","JoinListener","LeaveListener","TriggerListener","responses","checks","triggerMatches","trigger","every","AnnouncementListener","run","data","delay","tick","global","self","atoa","n","ticky","setImmediate","process","nextTick","debounce","ctx","thing","opts","evt","_once","off","c","et","emitterSnapshot","throws","listen","async","NativeCustomEvent","CustomEvent","foo","initCustomEvent","bubbles","cancelable","eventmap","eventname","ron","addEvent","removeEvent","fabricate","dragula_1","MessagesTab","setup","insertHTML","save","addMessage","matches","row","dragger","_el","_container","dataset","ui","getExports","JoinTab","LeaveTab","TriggerTab","AnnouncementTab","listeners","l","hasLoaded","delayLoad","timeout","userSend","addPlayerMessage","messageClass","chatUl","class","addGenericMessage","li","logJoins","consoleExports","logLeaves","logMessages","logOther","chatContainer","MutationObserver","total","addedHeight","scrollHeight","scrollTop","observe","childList","subtree","defaultRepo","addExtension","ids","removeExtension","extensionMap","deregisterExtension","shouldLoad","src","script","extension","values","title","description","ext_id","load","reloadExtension","repos","repoRequests","repo","all","flatten","supported","createPage","settingDefaults","backup","location","reload","settingsRoot","def","checked","String","importBackup","display","click","File","FileReader","FileList","Blob","files","reader","readAsText","worldId","toString","hostname","confirm","pollChat","CustomBot","loadChecker","newValue","loadWarner"],"mappings":"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"}