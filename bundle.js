!function(e){"use strict";function t(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&(n[i[s]]=e[i[s]]);return n}function n(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(r,a)}c((i=i.apply(e,t||[])).next())})}function i(e,t){return 0===e.localeCompare(t,void 0,{sensitivity:"base"})}function s(e,...t){return e.some(e=>t.some(t=>i(e,t)))}function o(e,t,n){if(t.isAdmin){const t=(n=n.toLocaleUpperCase()).replace(/^\/\w+? /,"");n.startsWith("/ADMIN ")?(ee(e.adminlist,t),te(e.blacklist,t)):n.startsWith("/UNADMIN ")?te(e.adminlist,t):n.startsWith("/MOD ")?(ee(e.modlist,t),te(e.blacklist,t)):n.startsWith("/UNMOD ")?te(e.modlist,t):n.startsWith("/BAN ")?(ne([e.adminlist,e.whitelist,e.modlist],t),ee(e.blacklist,t)):n.startsWith("/UNBAN ")?te(e.blacklist,t):n.startsWith("/WHITELIST ")?(te(e.blacklist,t),ee(e.whitelist,t)):n.startsWith("/UNWHITELIST ")&&te(e.whitelist,t)}}function r(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(r,a)}c((i=i.apply(e,t||[])).next())})}function a(e){const t={lt:"<",gt:">",amp:"&","#39":"'",quot:'"'};return e.replace(/&(lt|gt|amp|#39|quot);/g,(e,n)=>t[n])}function c(e,t={}){const n={"X-Requested-With":"XMLHttpRequest"};return"POST"==t.method&&(n["Content-Type"]="application/x-www-form-urlencoded"),fe(`${me}${e}`,Object.assign({mode:"same-origin",credentials:"same-origin",redirect:"follow",headers:n},t))}function l(e,t){return c(e,t).then(e=>e.json())}function d(e,t){return c(e,t).then(e=>e.text())}function u(){return r(this,void 0,void 0,function*(){const e=[];return(yield d("/worlds")).split("\n").forEach(t=>{if(/\t\tupdateWorld/.test(t)){const n=t.match(/name: '([^']+?)'/),i=t.match(/id: (\d+)/);e.push({name:a(n[1]),id:i[1]})}}),e})}function h(){const e=document.querySelector(".nav-slider-container .nav-slider"),t=()=>e.classList.toggle("is-active");for(let e of document.querySelectorAll(".nav-slider-toggle"))e.addEventListener("click",t);const n=new Map,i=new Map,s=document.getElementById("container"),o=document.querySelector(".nav-slider");o.addEventListener("click",e=>{let t=e.target;let i=n.get(t);i&&(Array.from(s.children).forEach(e=>e.classList.remove("visible")),i.classList.add("visible"),Array.from(o.querySelectorAll("span.nav-item")).forEach(e=>e.classList.remove("is-active")),t.classList.add("is-active"))});const r=(e,t)=>{let r=s.appendChild(document.createElement("div"));let a=o;t&&(a=i.get(t));let c=a.appendChild(document.createElement("span"));c.textContent=e;c.classList.add("nav-item");n.set(c,r);return r},a=e=>{for(let[t,i]of n.entries())if(i==e)return i.remove(),t.remove(),void n.delete(t)},c=(e,t,n)=>{let s=i.get(t);if(s)return void(s.children[0].textContent=e);let r=o;n&&(r=i.get(n));s=r.appendChild(document.createElement("details"));s.classList.add("nav-item");let a=s.appendChild(document.createElement("summary"));a.textContent=e;i.set(t,s)},l=e=>{let t=i.get(e);if(!t)return;for(let e of t.querySelectorAll("span"))a(n.get(e));i.delete(e);t.remove()},d=(e,t)=>{"string"==typeof e.text?t.textContent=e.text:"string"==typeof e.html&&(t.innerHTML=e.html);let n=["text","html","selector"];t instanceof HTMLTextAreaElement&&"value"in e&&(t.textContent=e.value,n.push("value"));if(t instanceof HTMLSelectElement&&"value"in e){let n=t.querySelector(`[value="${e.value}"]`);n&&(n.selected=!0)}Object.keys(e).filter(e=>!n.includes(e)).forEach(n=>t.setAttribute(n,e[n]))},u=(e,t,n)=>{"string"==typeof e&&(e=document.querySelector(e));"string"==typeof t&&(t=document.querySelector(t));let i=document.importNode(e.content,!0);for(let e of n){let t=i.querySelector(e.selector);t?d(e,t):console.warn(`Could not find ${e.selector}`,e)}t.appendChild(i)},h=(e,t=3)=>{let n=document.body.appendChild(document.createElement("div"));n.classList.add("bot-notification","is-active");n.textContent=e;let i=[setTimeout(()=>n.classList.remove("is-active"),1e3*t),setTimeout(()=>n.remove(),1e3*(t+1))];n.addEventListener("click",()=>{i.forEach(clearTimeout);n.remove()})};let p={active:!1,queue:[]};const m=document.getElementById("modal"),f=m.querySelector(".modal-card-body"),g=m.querySelector(".modal-card-foot"),v=e=>{let t=g.appendChild(document.createElement("a"));let n=["button"];"object"==typeof e?(e.style&&n.push(e.style),t.textContent=e.text):t.textContent=e;t.classList.add(...n)},b=()=>{p.active=!0;const{html:html,buttons:buttons,callback:callback}=p.queue.shift();f.innerHTML=html;Array.isArray(buttons)?buttons.forEach(v):v("OK");m.classList.add("is-active");g.addEventListener("click",function e(t){let n=t.target;if("A"==n.tagName){m.classList.remove("is-active");try{callback&&callback.call(null,n.textContent)}catch(e){console.error("Error calling alert callback",e)}g.innerHTML="",g.removeEventListener("click",e),p.active=!1,p.queue.length&&b()}})},y=(e,t,n)=>{p.queue.push({html:e,buttons:t,callback:n});p.active||b()},w=(e,t)=>{let n=document.createElement("p");n.textContent=e;y(n.outerHTML+`<textarea class="textarea"></textarea>`,["OK","Cancel"],()=>{let e=f.querySelector("textarea");t&&t(e.value||"")})};return{toggleMenu:t,addTab:r,removeTab:a,addTabGroup:c,removeTabGroup:l,buildTemplate:u,notify:h,alert:y,prompt:w}}function p(){if(!("open"in document.createElement("details"))){let e=document.createElement("style");e.textContent+=`details:not([open]) > :not(summary) { display: none !important } details > summary:before { content: "â–¶" display: inline-block font-size: .8em width: 1.5em font-family:"Courier New" } details[open] > summary:before { transform: rotate(90deg) }`,document.head.appendChild(e),window.addEventListener("click",function(e){let t=e.target;if("SUMMARY"==t.tagName){let e=t.parentNode;if(!e)return;e.getAttribute("open")?(e.open=!1,e.removeAttribute("open")):(e.open=!0,e.setAttribute("open","open"))}})}}function m(e,t){return e.joins>=t.joins_low&&e.joins<=t.joins_high}function f(e,t){return g(e,t.group)&&!g(e,t.not_group)}function g(e,t){switch(t){case"all":return!0;case"staff":return e.isStaff;case"mod":return e.isMod;case"admin":return e.isAdmin;case"owner":return e.isOwner;default:return!1}}function v(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(r,a)}c((i=i.apply(e,t||[])).next())})}function b(e,t,n,i){return e.addEventListener(t,n,i)}function y(e,t,n){return e.attachEvent("on"+t,L(e,t,n))}function w(e,t,n,i){return e.removeEventListener(t,n,i)}function x(e,t,n){var i=S(e,t,n);if(i)return e.detachEvent("on"+t,i)}function E(e,t,n){var i=-1===Pe.indexOf(t)?function(){return new Oe(t,{detail:n})}():function(){var e;return Ne.createEvent?(e=Ne.createEvent("Event")).initEvent(t,!0,!0):Ne.createEventObject&&(e=Ne.createEventObject()),e}();e.dispatchEvent?e.dispatchEvent(i):e.fireEvent("on"+t,i)}function _(e,t,n){return function(t){var i=t||Le.event;i.target=i.target||i.srcElement,i.preventDefault=i.preventDefault||function(){i.returnValue=!1},i.stopPropagation=i.stopPropagation||function(){i.cancelBubble=!0},i.which=i.which||i.keyCode,n.call(e,i)}}function L(e,t,n){var i=S(e,t,n)||_(e,t,n);return Re.push({wrapper:i,element:e,type:t,fn:n}),i}function S(e,t,n){var i=k(e,t,n);if(i){var s=Re[i].wrapper;return Re.splice(i,1),s}}function k(e,t,n){var i,s;for(i=0;i<Re.length;i++)if((s=Re[i]).element===e&&s.type===t&&s.fn===n)return i}function T(e){var t=Be[e];return t?t.lastIndex=0:Be[e]=t=new RegExp(We+e+He,"g"),t}function M(e,t){var n=e.className;n.length?T(t).test(n)||(e.className+=" "+t):e.className=t}function C(e,t){e.className=e.className.replace(T(t)," ").trim()}function O(e,t){function n(e){return-1!==se.containers.indexOf(e)||ie.isContainer(e)}function i(e){var t=e?"remove":"add";I($e,t,"mousedown",c),I($e,t,"mouseup",v)}function s(e){I($e,e?"remove":"add","mousemove",l)}function o(e){var t=e?"remove":"add";Ue[t]($e,"selectstart",a),Ue[t]($e,"click",a)}function r(){i(!0),v({})}function a(e){te&&e.preventDefault()}function c(e){if(G=e.clientX,F=e.clientY,!(1!==A(e)||e.metaKey||e.ctrlKey)){var t=e.target,n=d(t);n&&(te=n,s(),"mousedown"===e.type&&(W(t)?t.focus():e.preventDefault()))}}function l(e){if(te){if(0===A(e))return void v({});if(void 0===e.clientX||e.clientX!==G||void 0===e.clientY||e.clientY!==F){if(ie.ignoreInputTextSelection){var t=$("clientX",e),n=$("clientY",e);if(W(Xe.elementFromPoint(t,n)))return}var i=te;s(!0),o(),f(),p(i);var r=j(Y);z=$("pageX",e)-r.left,V=$("pageY",e)-r.top,Je.add(Q||Y,"gu-transit"),T(),L(e)}}}function d(e){if(!(se.dragging&&H||n(e))){for(var t=e;B(e)&&!1===n(B(e));){if(ie.invalid(e,t))return;if(!(e=B(e)))return}var i=B(e);if(i&&!ie.invalid(e,t)&&ie.moves(e,i,t,J(e)))return{item:e,source:i}}}function u(e){return!!d(e)}function h(e){var t=d(e);t&&p(t)}function p(e){P(e.item,e.source)&&(Q=e.item.cloneNode(!0),se.emit("cloned",Q,e.item,"copy")),X=e.source,Y=e.item,K=Z=J(e.item),se.dragging=!0,se.emit("drag",Y,X)}function m(){return!1}function f(){if(se.dragging){var e=Q||Y;b(e,B(e))}}function g(){te=!1,s(!0),o(!0)}function v(e){if(g(),se.dragging){var t=Q||Y,n=$("clientX",e),i=$("clientY",e),s=_(N(H,n,i),n,i);s&&(Q&&ie.copySortSource||!Q||s!==X)?b(t,s):ie.removeOnSpill?y():w()}}function b(e,t){var n=B(e);Q&&ie.copySortSource&&t===X&&n.removeChild(Y),E(t)?se.emit("cancel",e,X,X):se.emit("drop",e,t,X,Z),x()}function y(){if(se.dragging){var e=Q||Y,t=B(e);t&&t.removeChild(e),se.emit(Q?"cancel":"remove",e,t,X),x()}}function w(e){if(se.dragging){var t=arguments.length>0?e:ie.revertOnSpill,n=Q||Y,i=B(n),s=E(i);!1===s&&t&&(Q?i&&i.removeChild(Q):X.insertBefore(n,K)),s||t?se.emit("cancel",n,X,X):se.emit("drop",n,i,X,Z),x()}}function x(){var e=Q||Y;g(),M(),e&&Je.rm(e,"gu-transit"),ee&&clearTimeout(ee),se.dragging=!1,ne&&se.emit("out",e,ne,X),se.emit("dragend",e),X=Y=Q=K=Z=ee=ne=null}function E(e,t){var n;return n=void 0!==t?t:H?Z:J(Q||Y),e===X&&n===K}function _(e,t,i){for(var s=e;s&&!function(){if(!1===n(s))return!1;var o=C(s,e),r=O(s,o,t,i);return!!E(s,r)||ie.accepts(Y,s,X,r)}();)s=B(s);return s}function L(e){function t(e){se.emit(e,r,ne,X)}if(H){e.preventDefault();var n=$("clientX",e),i=$("clientY",e),s=n-z,o=i-V;H.style.left=s+"px",H.style.top=o+"px";var r=Q||Y,a=N(H,n,i),c=_(a,n,i),l=null!==c&&c!==ne;(l||null===c)&&(function(){ne&&t("out")}(),ne=c,function(){l&&t("over")}());var d=B(r);if(c===X&&Q&&!ie.copySortSource)return void(d&&d.removeChild(r));var u,h=C(c,a);if(null!==h)u=O(c,h,n,i);else{if(!0!==ie.revertOnSpill||Q)return void(Q&&d&&d.removeChild(r));u=K,c=X}(null===u&&l||u!==r&&u!==J(r))&&(Z=u,c.insertBefore(r,u),se.emit("shadow",r,c,X))}}function S(e){Je.rm(e,"gu-hide")}function k(e){se.dragging&&Je.add(e,"gu-hide")}function T(){if(!H){var e=Y.getBoundingClientRect();(H=Y.cloneNode(!0)).style.width=R(e)+"px",H.style.height=U(e)+"px",Je.rm(H,"gu-transit"),Je.add(H,"gu-mirror"),ie.mirrorContainer.appendChild(H),I($e,"add","mousemove",L),Je.add(ie.mirrorContainer,"gu-unselectable"),se.emit("cloned",H,Y,"mirror")}}function M(){H&&(Je.rm(ie.mirrorContainer,"gu-unselectable"),I($e,"remove","mousemove",L),B(H).removeChild(H),H=null)}function C(e,t){for(var n=t;n!==e&&B(n)!==e;)n=B(n);return n===$e?null:n}function O(e,t,n,i){function s(e){return e?J(t):t}var o="horizontal"===ie.direction;return t!==e?function(){var e=t.getBoundingClientRect();return s(o?n>e.left+R(e)/2:i>e.top+U(e)/2)}():function(){var t,s,r,a=e.children.length;for(t=0;t<a;t++){if(s=e.children[t],r=s.getBoundingClientRect(),o&&r.left+r.width/2>n)return s;if(!o&&r.top+r.height/2>i)return s}return null}()}function P(e,t){return"boolean"==typeof ie.copy?ie.copy:ie.copy(e,t)}1===arguments.length&&!1===Array.isArray(e)&&(t=e,e=[]);var H,X,Y,z,V,G,F,K,Z,Q,ee,te,ne=null,ie=t||{};void 0===ie.moves&&(ie.moves=D),void 0===ie.accepts&&(ie.accepts=D),void 0===ie.invalid&&(ie.invalid=m),void 0===ie.containers&&(ie.containers=e||[]),void 0===ie.isContainer&&(ie.isContainer=q),void 0===ie.copy&&(ie.copy=!1),void 0===ie.copySortSource&&(ie.copySortSource=!1),void 0===ie.revertOnSpill&&(ie.revertOnSpill=!1),void 0===ie.removeOnSpill&&(ie.removeOnSpill=!1),void 0===ie.direction&&(ie.direction="vertical"),void 0===ie.ignoreInputTextSelection&&(ie.ignoreInputTextSelection=!0),void 0===ie.mirrorContainer&&(ie.mirrorContainer=Xe.body);var se=Me({containers:ie.containers,start:h,end:f,cancel:w,remove:y,destroy:r,canMove:u,dragging:!1});return!0===ie.removeOnSpill&&se.on("over",S).on("out",k),i(),se}function I(e,t,n,i){var s={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},o={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},r={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};Le.navigator.pointerEnabled?Ue[t](e,o[n],i):Le.navigator.msPointerEnabled?Ue[t](e,r[n],i):(Ue[t](e,s[n],i),Ue[t](e,n,i))}function A(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var t=e.button;return void 0!==t?1&t?1:2&t?3:4&t?2:0:void 0}function j(e){var t=e.getBoundingClientRect();return{left:t.left+P("scrollLeft","pageXOffset"),top:t.top+P("scrollTop","pageYOffset")}}function P(e,t){return void 0!==Le[t]?Le[t]:$e.clientHeight?$e[e]:Xe.body[e]}function N(e,t,n){var i,s=e||{},o=s.className;return s.className+=" gu-hide",i=Xe.elementFromPoint(t,n),s.className=o,i}function q(){return!1}function D(){return!0}function R(e){return e.width||e.right-e.left}function U(e){return e.height||e.bottom-e.top}function B(e){return e.parentNode===Xe?null:e.parentNode}function W(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||H(e)}function H(e){return!!e&&("false"!==e.contentEditable&&("true"===e.contentEditable||H(B(e))))}function J(e){return e.nextElementSibling||function(){var t=e;do{t=t.nextSibling}while(t&&1!==t.nodeType);return t}()}function X(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}function $(e,t){var n=X(t),i={pageX:"clientX",pageY:"clientY"};return e in i&&!(e in n)&&i[e]in n&&(e=i[e]),n[e]}function Y(e,t){if(t)return t.classList.contains(e)?t:Y(e,t.parentElement)}function z(e){function t(e){for(i.push(e);i.length>100;)i.shift();s=i.length}function n(e){e!=i.slice(-1).pop()?t(e):s=i.length}let i=[],s=0;e.addEventListener("keydown",o=>{"ArrowUp"==o.key?(e.value.length&&s==i.length&&(t(e.value),s--),i.length&&s&&(e.value=i[--s])):"ArrowDown"==o.key?i.length>s+1?e.value=i[++s]:i.length==s+1&&(e.value="",s=i.length):"Enter"==o.key&&n(e.value)})}function V(e){const t=e.env.toLocaleLowerCase();return[t.includes("all"),t.includes("browser"),t.includes("mac")&&t.includes("cloud")].some(Boolean)&&/\.(m?js|es)/.test(e.package)}class G{constructor(e,t){this.bot=t,this.exports={},this.storage=t.storage.prefix(e),this.world=t.world}remove(){}uninstall(){this.remove(),this.storage.clear()}}class F{constructor(e,t,n){this._name=e,this._info=t,this._lists=n}get name(){return this._name}get ip(){return this._info.ip}get ips(){return[...this._info.ips]}get joins(){return this._info.joins}get hasJoined(){return this.joins>0}get isOwner(){return!!this._info.owner||"SERVER"==this._name}get isAdmin(){return this.isOwner||s(this._lists.adminlist,this._name,this._info.ip)}get isMod(){return!this.isAdmin&&s(this._lists.modlist,this._name,this._info.ip)}get isStaff(){return this.isAdmin||this.isMod}get isWhitelisted(){return this.isStaff||s(this._lists.whitelist,this._name,this._info.ip)}get isBanned(){return!this.isStaff&&this._lists.blacklist.some(e=>{e.includes(" \\")&&(e=e.substr(0,e.indexOf(" \\")));if(i(this._name,e))return!0;if(this._info.ips.includes(e))return!0;return!1})}}class K{constructor(){this.subscribers=[]}sub(e){this.subscribers.push({listener:e,once:!1})}unsub(e){let t=this.subscribers.findIndex(t=>e==t.listener);-1!=t&&this.subscribers.splice(t,1)}one(e){this.subscribers.push({listener:e,once:!0})}dispatch(e){this.subscribers.forEach(({listener:listener,once:once})=>{once&&this.unsub(listener);listener(e)})}asEvent(){let e=this;return{sub(t){return e.sub(t)},one(t){return e.one(t)},unsub(t){return e.unsub(t)}}}}var Z=function(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(r,a)}c((i=i.apply(e,t||[])).next())})};class Q{constructor(e,t){this.api=e,this.online=t,this._onMessage=new K,this._onJoin=new K,this._onLeave=new K,this._onOther=new K,this.timeoutId=null,this.parse=(e=>{let t=()=>{this._onOther.dispatch(e)};if(/^[^a-z]+ - Player Connected /.test(e)){try{let[,t,n]=e.match(/Connected ([^a-z]{3,}) \| ([\d.]+) \| .{32}$/);if(!this.online.includes(t))return this.online.includes(t)||this.online.push(t),void this._onJoin.dispatch({name:t,ip:n})}catch(e){}return t()}if(/^[^a-z]+ - Player Disconnected /.test(e)){try{let[,t]=e.match(/Disconnected ([^a-z]{3,})$/);if(this.online.includes(t))return this.online.splice(this.online.indexOf(t),1),void this._onLeave.dispatch(t)}catch(e){}return t()}if(e.slice(0,18).includes(": ")){let n=this.getUser(e);if(n)return e=e.substr(n.length+2),"SERVER"==n&&e.startsWith("/")?t():void this._onMessage.dispatch({name:n,message:e})}return t()}),this.checkChat=(e=>Z(this,void 0,void 0,function*(){try{let{log:log,nextId:nextId}=yield this.api.getMessages(e);if(null==this.timeoutId)return;log.forEach(this.parse),this.timeoutId=setTimeout(this.checkChat,5e3,nextId)}catch(e){return void(this.timeoutId=setTimeout(this.checkChat,3e4,0))}}))}get onJoin(){return this._onJoin.asEvent()}get onLeave(){return this._onLeave.asEvent()}get onMessage(){return this._onMessage.asEvent()}get onOther(){return this._onOther.asEvent()}get running(){return null!=this.timeoutId}start(){this.timeoutId&&this.stop(),this.timeoutId=setTimeout(this.checkChat,0,0)}stop(){this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=null}getUser(e){for(let t=18;t>4;t--){let n=e.substring(0,e.lastIndexOf(": ",t));if(this.online.includes(n)||"SERVER"==n)return n}return/[^a-z]{3,16}: /.test(e)?e.substring(0,e.lastIndexOf(": ",18)):""}}const ee=(e,t)=>!e.includes(t)&&e.push(t),te=(e,t)=>{const n=e.indexOf(t);if(-1==n)return;e.splice(n,1)},ne=(e,t)=>e.forEach(e=>te(e,t));var ie=function(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(r,a)}c((i=i.apply(e,t||[])).next())})};const se=e=>new Date(e.getTime());class oe{constructor(e,t){this._cache={},this._events={onJoin:new K,onLeave:new K,onMessage:new K},this._online=[],this._lists={adminlist:[],modlist:[],whitelist:[],blacklist:[]},this._commands=new Map,this._firstChatUpdate=Date.now(),this.getOverview=((e=!1)=>ie(this,void 0,void 0,function*(){if(!this._cache.overview||e){let e=yield this._cache.overview=this._api.getOverview();e.online.forEach(e=>this._online.includes(e)||this._online.push(e)),this._storage.with("players",{},t=>{t[e.owner]=t[e.owner]||{ip:"",ips:[],joins:0};t[e.owner].owner=!0})}let t=yield this._cache.overview;return Object.assign({},t,{created:se(t.created),last_activity:se(t.last_activity),credit_until:se(t.credit_until),online:this.online})})),this.getStatus=(()=>this._api.getStatus()),this.getLists=((e=!1)=>{this._cache.lists&&!e||(this._cache.lists=this._api.getLists().then(e=>this._lists=e));return this._cache.lists.then(e=>({adminlist:[...e.adminlist],modlist:[...e.modlist],whitelist:[...e.whitelist],blacklist:[...e.blacklist]}))}),this.setLists=(e=>ie(this,void 0,void 0,function*(){let t=yield this.getLists();yield this._api.setLists(Object.assign({},t,e)),yield this.getLists(!0)})),this.getLogs=((e=!1)=>ie(this,void 0,void 0,function*(){if(!this._cache.logs||e){const e=!this._cache.logs;this._cache.logs=this._api.getLogs(),e&&(yield this._updatePlayers())}return(yield this._cache.logs).slice().map(e=>Object.assign({},e,{timestamp:se(e.timestamp)}))})),this.send=(e=>{e.startsWith("/")&&this._events.onMessage.dispatch({player:this.getPlayer("SERVER"),message:e});return this._api.send(e)}),this.getPlayer=(e=>{e=e.toLocaleUpperCase();let t=this._storage.get("players",{});return new F(e,t[e]||{ip:"",ips:[],joins:0},this._lists)}),this.addCommand=((e,t)=>{e=e.toLocaleUpperCase();if(this._commands.has(e))throw new Error(`The command "${e}" has already been added.`);this._commands.set(e,t)}),this.removeCommand=(e=>{this._commands.delete(e.toLocaleUpperCase())}),this.start=(()=>this._api.start()),this.stop=(()=>this._api.stop()),this.restart=(()=>this._api.restart()),this.startWatchingChat=(()=>this._chatWatcher.start()),this.stopWatchingChat=(()=>this._chatWatcher.stop()),this._api=e,this._storage=t,this._lastLogUpdate=t.get("lastPlayersUpdate",0),this._createWatcher(),this.getOverview(),this.getLists()}get onJoin(){return this._events.onJoin.asEvent()}get onLeave(){return this._events.onLeave.asEvent()}get onMessage(){return this._events.onMessage.asEvent()}get onOther(){return this._chatWatcher.onOther}get online(){return[...this._online]}get players(){let e=this._storage.get("players",{});return Object.keys(e).map(this.getPlayer)}_createWatcher(){let e=this._chatWatcher=new Q(this._api,this._online);e.onJoin.sub(e=>this._userJoin(e)),e.onLeave.sub(e=>this._events.onLeave.dispatch(this.getPlayer(e))),e.onMessage.sub(({name:name,message:message})=>{const e=this.getPlayer(name);this._events.onMessage.dispatch({player:e,message:message});o(this._lists,e,message)}),this.onMessage.sub(({player:player,message:message})=>{if(/^\/[^ ]/.test(message)){const[,e,t]=message.match(/^\/([^ ]+) ?(.*)$/),n=this._commands.get(e.toLocaleUpperCase());n&&n(player,t)}})}_updatePlayers(){return ie(this,void 0,void 0,function*(){const e=yield this.getLogs(),{name:name}=yield this.getOverview();for(const t of e)if(!(t.timestamp.getTime()<this._lastLogUpdate)&&!(t.timestamp.getTime()>this._firstChatUpdate)&&t.message.startsWith(`${name} - Player Connected`)){const[,e,n]=t.message.match(/Connected ([^a-z]{3,}) \| ([\d.]+) \| .{32}$/);this._recordJoin({name:e,ip:n})}})}_recordJoin({name:name,ip:ip}){name=name.toLocaleUpperCase(),this._storage.with("players",{},e=>{const t=e[name]=e[name]||{ip:ip,ips:[ip],joins:0};t.joins++;t.ip=ip;t.ips.includes(ip)||t.ips.push(ip)}),this._storage.set("lastPlayersUpdate",Date.now())}_userJoin({name:name,ip:ip}){this._recordJoin({name:name,ip:ip}),this._events.onJoin.dispatch(this.getPlayer(name))}}class re{with(e,t,n){let i=this.get(e,t),s=n(i);this.set(e,null==s?i:s)}}var ae=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&(n[i[s]]=e[i[s]]);return n};let ce=new Map,le=new K,de=new K;class ue{constructor(e,t){if(this.storage=e,this._extensions=new Map,!ue.dependencies)throw new Error("Dependencies must be set before creating this class.");this.world=new oe(new ue.dependencies.Api(t),e)}static registerExtension(e,t){e=e.toLocaleLowerCase(),ce.set(e,t),le.dispatch(e)}static deregisterExtension(e){e=e.toLocaleLowerCase(),ce.delete(e)&&de.dispatch(e)}static get extensions(){return[...ce.keys()]}get extensions(){return[...this._extensions.keys()]}get fetch(){return ue.dependencies.fetch}start(){this.world.startWatchingChat()}getExports(e){let t=this._extensions.get(e.toLocaleLowerCase());if(t)return t.exports}addExtension(e){if(e=e.toLocaleLowerCase(),this._extensions.has(e))throw new Error(`The ${e} extension has already been added.`);let t=ce.get(e);if(!t)throw new Error(`The ${e} extension has not been registered.`);let n=new G(e,this);this._extensions.set(e,n),t.call(n,n,this.world)}removeExtension(e,t){e=e.toLocaleLowerCase();let n=this._extensions.get(e);if(!n)throw new Error(`The ${e} extension is not registered.`);try{t?n.uninstall():n.remove()}finally{this._extensions.delete(e)}}send(e,t={}){var n=ae(t,[]);if(n.name&&n.name.length){let e=n.name.toLocaleLowerCase();n=Object.assign({},n,{name:e,Name:e[0].toLocaleUpperCase()+e.substr(1),NAME:e.toLocaleUpperCase()})}let i=Object.keys(n).map(e=>e.replace(/([.+?^=!:${}()|\[\]\/\\])/g,"\\$1")).join("}}|{{");i.length&&(e=e.replace(new RegExp(`{{${i}}}`,"g"),e=>n[e.substring(2,e.length-2)])),this.world.send(e).catch(()=>{})}}ue.extensionRegistered=le.asEvent(),ue.extensionDeregistered=de.asEvent();class he extends ue{send(e,n={}){var i=t(n,[]);let s;s=this.storage.get("splitMessages",!1)?e.split(this.storage.get("splitToken","<split>")):[e];for(let e of s)super.send(e,i)}}class pe{constructor(){this.parse=(e=>{e=e.slice(0);for(let t=e.length-1;t>0;t--){const n=e[t];this.isValidLine(n)?this.addLine(n):e[t-1]+="\n"+e.splice(t,1)}this.isValidLine(e[0])&&this.addLine(e[0]);const t=this.entries.reverse();this.entries=[];return t}),this.isValidLine=(e=>/^\d{4}-\d\d-\d\d \d\d:\d\d:\d\d\.\d{3} blockheads_server/.test(e)),this.addLine=(e=>{const t=e.substr(0,24).replace(" ","T").replace(" ","Z");this.entries.push({raw:e,timestamp:new Date(t),message:e.substr(e.indexOf("]")+2)})}),this.entries=[]}}const me="http://portal.theblockheads.net";let fe;try{fe=fetch}catch(e){}class ge{constructor(e){this.info=e,this.parser=new pe,this.getLists=(()=>r(this,void 0,void 0,function*(){const e=yield d(`/worlds/lists/${this.info.id}`),t=t=>{let n=[];const i=e.match(new RegExp(`<textarea name="${t}">([\\s\\S]*?)</textarea>`));i&&(n=a(i[1]).split(/\r?\n/));return Array.from(new Set(n)).filter(Boolean)};return{adminlist:t("admins"),modlist:t("modlist"),whitelist:t("whitelist"),blacklist:t("blacklist")}})),this.setLists=(e=>r(this,void 0,void 0,function*(){const t=e=>encodeURIComponent(e.join("\n"));let n=`admins=${t(e.adminlist)}`;n+=`&modlist=${t(e.modlist)}`,n+=`&whitelist=${t(e.whitelist)}`,n+=`&blacklist=${t(e.blacklist)}`,yield l(`/worlds/lists/${this.info.id}`,{method:"POST",body:n})})),this.getOverview=(()=>r(this,void 0,void 0,function*(){const e=yield d(`/worlds/${this.info.id}`),t=(t,n="")=>{const i=e.match(t);return i?i[1]:n},n=t(/^\$\('#privacy'\).val\('(.*?)'\)/m,"public");let i=[];const s=e.match(/^\t<tr><td class="left">(.*?)(?=<\/td>)/gm);return s&&(i=i.concat(s.map(e=>e.substr(22)))),{name:t(/^\t<title>(.*?) Manager \| Portal<\/title>$/m),owner:t(/^\t\t<td class="right">Owner:<\/td>\r?\n\t\t<td>(.*?)<\/td>$/m),created:new Date(t(/^\t\t<td>Created:<\/td><td>(.*?)<\/td>$/m)+" GMT-0000"),last_activity:new Date(t(/^\t\t<td>Last Activity:<\/td><td>(.*?)<\/td>$/m)+" GMT-0000"),credit_until:new Date(t(/^\t\t<td>Credit Until:<\/td><td>(.*?)<\/td>$/m)+" GMT-0000"),link:t(/^\t<tr><td>Link:<\/td><td><a href="(.*?)">\1<\/a>/m),pvp:!!t(/^\$\('#pvp'\)\./m),privacy:n,password:"Yes"==t(/^\t\t<td>Password:<\/td><td>(Yes|No)<\/td><\/tr>$/m),size:t(/^\t\t<td>Size:<\/td><td>(.*?)<\/td>$/m),whitelist:"Yes"==t(/<td>Whitelist:<\/td><td>(Yes|No)<\/td>/m),online:i,status:t(/^updateWorld\({id: \d+, worldStatus: '(.*?)'/m)}})),this.getLogs=(()=>d(`/worlds/logs/${this.info.id}`).then(e=>e.split("\n")).then(e=>this.parser.parse(e))),this.getMessages=((e=0)=>l("/api",{method:"POST",body:`command=getchat&worldId=${this.info.id}&firstId=${e}`}).then(({status:status,log:log,nextId:nextId})=>{if("ok"!=status)return{log:[],nextId:0};return{nextId:nextId,log:log}},()=>({log:[],nextId:e}))),this.getStatus=(()=>l("/api",{method:"POST",body:`command=status&worldId=${this.info.id}`}).then(e=>e.worldStatus)),this.send=(e=>l("/api",{method:"POST",body:`command=send&worldId=${this.info.id}&message=${encodeURIComponent(e)}`}).then(t=>{if("ok"==t.status)return;throw new Error(`Unable to send ${e}`)})),this.start=(()=>l("/api",{method:"POST",body:`command=start&worldId=${this.info.id}`}).then(()=>void 0,console.error)),this.stop=(()=>l("/api",{method:"POST",body:`command=stop&worldId=${this.info.id}`}).then(()=>void 0,console.error)),this.restart=(()=>l("/api",{method:"POST",body:`command=reboot&worldId=${this.info.id}`}).then(()=>void 0,console.error))}get name(){return this.info.name}get id(){return this.info.id}}class ve extends re{constructor(e){super(),this.head=e,this.head+="/"}get(e,t){const n=localStorage.getItem(this.head+e);try{const e=JSON.parse(n);return null==e?t:e}catch(e){return t}}set(e,t){localStorage.setItem(this.head+e,JSON.stringify(t))}clear(e=""){this.keys(e).forEach(e=>localStorage.removeItem(this.head+e))}keys(e=""){return Object.keys(localStorage).filter(t=>t.startsWith(this.head+e)).map(e=>e.substr(this.head.length))}prefix(e){return new ve(this.head+e)}}ue.registerExtension("ui",function(e){if("undefined"==typeof document)throw new Error("This extension cannot be loaded outside of a browser environment.");e.uninstall=function(){throw new Error("The UI extension cannot be removed once loaded")},document.body.innerHTML='<header class="header is-fixed-top">\r\n    <nav class="navbar is-primary" role="navigation" aria-label="main navigation">\r\n        <div class="navbar-brand">\r\n            <div class="navbar-item nav-slider-toggle">\r\n                <img src="https://gitcdn.xyz/cdn/Blockheads-Messagebot/UI/master/logo.png">\r\n            </div>\r\n            <a class="navbar-item nav-slider-toggle">Menu</a>\r\n        </div>\r\n    </nav>\r\n</header>\r\n\r\n<div class="nav-slider-container">\r\n    <nav class="nav-slider"></nav>\r\n    <div class="is-overlay nav-slider-toggle"></div>\r\n</div>\r\n\r\n<div id="container" class="has-fixed-nav"></div>\r\n\r\n\r\n<div id="modal" class="modal">\r\n    <div class="modal-background"></div>\r\n    <div class="modal-card">\r\n        <header class="modal-card-head"></header>\r\n        <section class="modal-card-body"></section>\r\n        <footer class="modal-card-foot"></footer>\r\n    </div>\r\n</div>\r\n',document.head.querySelectorAll("link").forEach(e=>e.remove());let t=document.head.appendChild(document.createElement("link"));t.rel="stylesheet",t.href="https://gitcdn.xyz/cdn/Blockheads-Messagebot/UI/master/index.css",p(),e.exports=h()});class be{constructor(e,t){this.id=e,this.ex=t}get messages(){return this.ex.storage.get(this.id,[])}}class ye extends be{constructor(e){super("joinArr",e),this.listener=(e=>{for(let t of this.messages)m(e,t)&&f(e,t)&&this.ex.bot.send(t.message,{name:e.name})}),this.ex.world.onJoin.sub(this.listener)}remove(){this.ex.world.onJoin.unsub(this.listener)}}class we extends be{constructor(e){super("leaveArr",e),this.listener=(e=>{for(let t of this.messages)m(e,t)&&f(e,t)&&this.ex.bot.send(t.message,{name:e.name})}),this.ex.world.onLeave.sub(this.listener)}remove(){this.ex.world.onLeave.unsub(this.listener)}}class xe extends be{constructor(e){super("triggerArr",e),this.listener=(({player:player,message:message})=>{if("SERVER"==player.name)return;let e=0;for(let t of this.messages){let n=[m(player,t),f(player,t),this.triggerMatches(message,t.trigger)];n.every(Boolean)&&++e<=this.ex.storage.get("maxResponses",3)&&this.ex.bot.send(t.message,{name:player.name})}}),this.ex.world.onMessage.sub(this.listener)}remove(){this.ex.world.onMessage.unsub(this.listener)}triggerMatches(e,t){if(this.ex.storage.get("disableWhitespaceTrimming",!1)||(t=t.trim()),this.ex.storage.get("regexTriggers",!1))try{return new RegExp(t,"i").test(e)}catch(e){return!1}return t=t.replace(/([.+?^=!:${}()|\[\]\/\\])/g,"\\$1").replace(/\*/g,".*"),new RegExp(t,"i").test(e)}}class Ee extends be{constructor(e){super("announcementArr",e),this.index=0,this.run=(()=>{this.index>=this.messages.length&&(this.index=0);if(this.ex.world.online.length){const e=this.messages[this.index];e&&e.message&&this.ex.bot.send(e.message)}else this.index=0;this.timeoutId=setTimeout(this.run,this.delay)}),this.timeoutId=setTimeout(this.run,this.delay)}get delay(){return 6e4*this.ex.storage.get("announcementDelay",10)}remove(){clearTimeout(this.timeoutId)}}var _e,Le="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Se=function(e,t){return Array.prototype.slice.call(e,t)},ke=_e="function"==typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof process&&process.nextTick?process.nextTick:function(e){setTimeout(e,0)},Te=function(e,t,n){e&&ke(function(){e.apply(n||null,t||[])})},Me=function(e,t){var n=t||{},i={};return void 0===e&&(e={}),e.on=function(t,n){return i[t]?i[t].push(n):i[t]=[n],e},e.once=function(t,n){return n._once=!0,e.on(t,n),e},e.off=function(t,n){var s=arguments.length;if(1===s)delete i[t];else if(0===s)i={};else{var o=i[t];if(!o)return e;o.splice(o.indexOf(n),1)}return e},e.emit=function(){var t=Se(arguments);return e.emitterSnapshot(t.shift()).apply(this,t)},e.emitterSnapshot=function(t){var s=(i[t]||[]).slice(0);return function(){var i=Se(arguments),o=this||e;if("error"===t&&!1!==n.throws&&!s.length)throw 1===i.length?i[0]:i;return s.forEach(function(s){n.async?Te(s,i,o):s.apply(o,i),s._once&&e.off(t,s)}),e}},e},Ce=Le.CustomEvent,Oe=function(){try{var e=new Ce("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}()?Ce:"function"==typeof document.createEvent?function(e,t){var n=document.createEvent("CustomEvent");return t?n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n.initCustomEvent(e,!1,!1,void 0),n}:function(e,t){var n=document.createEventObject();return n.type=e,t?(n.bubbles=Boolean(t.bubbles),n.cancelable=Boolean(t.cancelable),n.detail=t.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n},Ie=[],Ae="",je=/^on/;for(Ae in Le)je.test(Ae)&&Ie.push(Ae.slice(2));var Pe=Ie,Ne=Le.document,qe=b,De=w,Re=[];Le.addEventListener||(qe=y,De=x);var Ue={add:qe,remove:De,fabricate:E},Be={},We="(?:^|\\s)",He="(?:\\s|$)",Je={add:M,rm:C},Xe=document,$e=Xe.documentElement,Ye=O;class ze extends be{constructor({name:name,ex:ex,id:id}){super(id,ex),this.setup=(()=>v(this,void 0,void 0,function*(){this.insertHTML(),this.template=this.tab.querySelector("template"),this.root=this.tab.querySelector(".messages-container"),this.tab.addEventListener("input",()=>this.save()),this.tab.querySelector(".button.is-primary").addEventListener("click",()=>this.addMessage()),this.tab.addEventListener("click",e=>{const t=e.target;if(t.matches("[data-do=delete]")){e.preventDefault();const n=Y("box",t);if(!n)return;n.remove()}this.save()});const e=Ye([this.root],{moves(e,t,n){return n.classList.contains("drag")}});e.on("drop",()=>this.save()),e.on("drag",e=>{const t=e.querySelector("details");t&&(t.open=!1)}),this.ex.storage.get(this.id,[]).forEach(e=>{this.addMessage(e)})})),this.getMessages=(()=>{let e=[];this.root.querySelectorAll(".box").forEach(t=>{let n={};t.querySelectorAll("[data-target]").forEach(e=>{let t=e.dataset.target;if(!t)return;switch(e.getAttribute("type")){case"number":n[t]=+e.value;break;default:n[t]=e.value}});e.push(n)});return e}),this.ui=ex.bot.getExports("ui"),this.ex=ex,this.tab=this.ui.addTab(name,"messages")}remove(){this.ui.removeTab(this.tab)}save(){this.ex.storage.set(this.id,this.getMessages())}}class Ve extends ze{constructor(e){super({name:"Join",id:"joinArr",ex:e}),this.insertHTML=(()=>{this.tab.innerHTML='<template>\r\n    <div class="box">\r\n        <div class="columns">\r\n            <div class="column is-narrow is-hidden-touch">\r\n                <span class="drag"></span>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <p class="has-text-weight-bold">Message</p>\r\n            </div>\r\n            <div class="column">\r\n                <textarea class="textarea is-small is-fluid" data-target="message"></textarea>\r\n            </div>\r\n            <div class="column is-3">\r\n                <details>\r\n                    <summary>More options</summary>\r\n                    <div class="level-options">\r\n                        <p class="has-text-weight-bold">Player is </p>\r\n                        <div class="control">\r\n                            <select data-target="group" class="select is-small">\r\n                                <option value="all">anyone</option>\r\n                                <option value="staff">a staff member</option>\r\n                                <option value="mod">a mod</option>\r\n                                <option value="admin">an admin</option>\r\n                                <option value="owner">the owner</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div class="level-options">\r\n                        <p class="has-text-weight-bold">Player is not </p>\r\n                        <div class="control">\r\n                            <select data-target="not_group" class="select is-small">\r\n                                <option value="nobody">nobody</option>\r\n                                <option value="staff">a staff member</option>\r\n                                <option value="mod">a mod</option>\r\n                                <option value="admin">an admin</option>\r\n                                <option value="owner">the owner</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div class="level-options">\r\n                        <div class="control">\r\n                            <input type="number" class="input is-small" value="0" data-target="joins_low" min="0">\r\n                            <span class="has-text-weight-bold"> &le; player joins &le; </span>\r\n                            <input type="number" class="input is-small" value="9999" data-target="joins_high">\r\n                        </div>\r\n                    </div>\r\n                </details>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <button class="button is-small is-danger is-outlined" data-do="delete">Delete</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<div class="container is-widescreen">\r\n    <section class="section is-small">\r\n        <span class="button is-primary is-adding-message">+</span>\r\n        <h3 class="title is-4">Join Messages</h3>\r\n        <ul>\r\n            <li>These messages will be checked when a player joins the server.</li>\r\n            <li>{{NAME}}, {{Name}}, and {{name}} in the message will be replaced with the user\'s name.</li>\r\n        </ul>\r\n    </section>\r\n    <div class="messages-container"></div>\r\n</div>\r\n'}),this.addMessage=((e={})=>{this.ui.buildTemplate(this.template,this.root,[{selector:"[data-for=message-trim]",text:e.message||""},{selector:"[data-target=message]",text:e.message||""},{selector:"[data-target=joins_low]",value:e.joins_low||0},{selector:"[data-target=joins_high]",value:e.joins_high||9999},{selector:"[data-target=group]",value:e.group||"all"},{selector:"[data-target=not_group]",value:e.not_group||"nobody"}])})}}class Ge extends ze{constructor(e){super({name:"Leave",id:"leaveArr",ex:e}),this.insertHTML=(()=>{this.tab.innerHTML='<template>\r\n    <div class="box">\r\n        <div class="columns">\r\n            <div class="column is-narrow is-hidden-touch">\r\n                <span class="drag"></span>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <p class="has-text-weight-bold">Message</p>\r\n            </div>\r\n            <div class="column">\r\n                <textarea class="textarea is-small is-fluid" data-target="message"></textarea>\r\n            </div>\r\n            <div class="column is-3">\r\n                <details>\r\n                    <summary>More options</summary>\r\n                    <div class="level-options">\r\n                        <p class="has-text-weight-bold">Player is </p>\r\n                        <div class="control">\r\n                            <select data-target="group" class="select is-small">\r\n                                <option value="all">anyone</option>\r\n                                <option value="staff">a staff member</option>\r\n                                <option value="mod">a mod</option>\r\n                                <option value="admin">an admin</option>\r\n                                <option value="owner">the owner</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div class="level-options">\r\n                        <p class="has-text-weight-bold">Player is not </p>\r\n                        <div class="control">\r\n                            <select data-target="not_group" class="select is-small">\r\n                                <option value="nobody">nobody</option>\r\n                                <option value="staff">a staff member</option>\r\n                                <option value="mod">a mod</option>\r\n                                <option value="admin">an admin</option>\r\n                                <option value="owner">the owner</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div class="level-options">\r\n                        <div class="control">\r\n                            <input type="number" class="input is-small" value="0" data-target="joins_low" min="0">\r\n                            <span class="has-text-weight-bold"> &le; player joins &le; </span>\r\n                            <input type="number" class="input is-small" value="9999" data-target="joins_high">\r\n                        </div>\r\n                    </div>\r\n                </details>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <button class="button is-small is-danger is-outlined" data-do="delete">Delete</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<div class="container is-widescreen">\r\n    <section class="section is-small">\r\n        <span class="button is-primary is-adding-message">+</span>\r\n        <h3 class="title is-4">Leave Messages</h3>\r\n        <ul>\r\n            <li>These messages will be checked when a player leaves the server.</li>\r\n            <li>{{NAME}}, {{Name}}, and {{name}} in the message will be replaced with the user\'s name.</li>\r\n        </ul>\r\n    </section>\r\n    <div class="messages-container"></div>\r\n</div>\r\n'}),this.addMessage=((e={})=>{this.ui.buildTemplate(this.template,this.root,[{selector:"[data-for=message-trim]",text:e.message||""},{selector:"[data-target=message]",text:e.message||""},{selector:"[data-target=joins_low]",value:e.joins_low||0},{selector:"[data-target=joins_high]",value:e.joins_high||9999},{selector:"[data-target=group]",value:e.group||"all"},{selector:"[data-target=not_group]",value:e.not_group||"nobody"}])})}}class Fe extends ze{constructor(e){super({name:"Trigger",id:"triggerArr",ex:e}),this.insertHTML=(()=>{this.tab.innerHTML='<template>\r\n    <div class="box">\r\n        <div class="columns">\r\n            <div class="column is-narrow is-hidden-touch">\r\n                <span class="drag"></span>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <p class="has-text-weight-bold">Trigger</p>\r\n            </div>\r\n            <div class="column is-2-desktop">\r\n                <input class="input is-small" data-target="trigger">\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <p class="has-text-weight-bold">Message</p>\r\n            </div>\r\n            <div class="column">\r\n                <textarea class="textarea is-small is-fluid" data-target="message"></textarea>\r\n            </div>\r\n            <div class="column is-3">\r\n                <details>\r\n                    <summary>More options</summary>\r\n                    <div class="level-options">\r\n                        <p class="has-text-weight-bold">Player is </p>\r\n                        <div class="control">\r\n                            <select data-target="group" class="select is-small">\r\n                                <option value="all">anyone</option>\r\n                                <option value="staff">a staff member</option>\r\n                                <option value="mod">a mod</option>\r\n                                <option value="admin">an admin</option>\r\n                                <option value="owner">the owner</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div class="level-options">\r\n                        <p class="has-text-weight-bold">Player is not </p>\r\n                        <div class="control">\r\n                            <select data-target="not_group" class="select is-small">\r\n                                <option value="nobody">nobody</option>\r\n                                <option value="staff">a staff member</option>\r\n                                <option value="mod">a mod</option>\r\n                                <option value="admin">an admin</option>\r\n                                <option value="owner">the owner</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div class="level-options">\r\n                        <div class="control">\r\n                            <input type="number" class="input is-small" value="0" data-target="joins_low" min="0">\r\n                            <span class="has-text-weight-bold"> &le; player joins &le; </span>\r\n                            <input type="number" class="input is-small" value="9999" data-target="joins_high">\r\n                        </div>\r\n                    </div>\r\n                </details>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <button class="button is-small is-danger is-outlined" data-do="delete">Delete</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<div class="container is-widescreen">\r\n    <section class="section is-small">\r\n        <span class="button is-primary is-adding-message" title="Add trigger message">+</span>\r\n        <h3 class="title is-4">Triggers</h3>\r\n        <ul>\r\n            <li>The trigger will be checked against chat messages, if it matches, the message will be sent.</li>\r\n            <li>Triggers are case-insensitive.</li>\r\n            <li>{{NAME}}, {{Name}}, and {{name}} in the message will be replaced with the user\'s name.</li>\r\n            <li><code>*</code> will be treated as a wildcard.</li>\r\n            <li>Triggers are matched in order, if more than the max number are matched, later triggers will not be sent.</li>\r\n            <li>Change the maximum number of responses under settings.</li>\r\n        </ul>\r\n    </section>\r\n\r\n    <div class="messages-container"></div>\r\n</div>\r\n'}),this.addMessage=((e={})=>{this.ui.buildTemplate(this.template,this.root,[{selector:"[data-target=message]",text:e.message||""},{selector:"[data-target=trigger]",value:e.trigger||""},{selector:"[data-target=joins_low]",value:e.joins_low||0},{selector:"[data-target=joins_high]",value:e.joins_high||9999},{selector:"[data-target=group]",value:e.group||"all"},{selector:"[data-target=not_group]",value:e.not_group||"nobody"}])})}}class Ke extends ze{constructor(e){super({name:"Announcements",id:"announcementArr",ex:e}),this.insertHTML=(()=>{this.tab.innerHTML='<template>\r\n    <div class="box">\r\n        <div class="columns">\r\n            <div class="column is-narrow is-hidden-touch">\r\n                <span class="drag"></span>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <p class="has-text-weight-bold">Message</p>\r\n            </div>\r\n            <div class="column">\r\n                <textarea class="textarea is-small is-fluid" data-target="message"></textarea>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <button class="button is-small is-danger is-outlined" data-do="delete">Delete</button>\r\n            </div>\r\n        </div>\r\n        <div>\r\n            Wait X minutes...\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<div class="container is-widescreen">\r\n    <section class="section is-small">\r\n        <span class="button is-primary is-adding-message">+</span>\r\n        <h3 class="title is-4">Announcements</h3>\r\n        <ul>\r\n            <li>These are sent according to a regular schedule.</li>\r\n            <li>If you have one announcement, it is sent every X minutes, if you have two, then the first is sent at X minutes, and the second\r\n            is sent X minutes after the first. Change X in the settings tab. Once the bot reaches the end of the list, it starts over\r\n            at the top.</li>\r\n            <li>If no players are online when a message is scheduled to be sent, no message will be sent and the next message will reset to the first message.</li>\r\n        </ul>\r\n    </section>\r\n    <div class="messages-container"></div>\r\n</div>\r\n'}),this.addMessage=((e={})=>{this.ui.buildTemplate(this.template,this.root,[{selector:"[data-target=message]",text:e.message||""}])})}}ue.registerExtension("messages",function(e,t){let n=[];e.remove=(()=>n.forEach(e=>e.remove()));let i=!1,s=()=>{if(i)return;i=!0;let t=setTimeout(()=>{n=[new ye(e),new we(e),new xe(e),new Ee(e)]},500);n=[{remove:()=>clearTimeout(t)}]};if(t.onJoin.one(s),t.onLeave.one(s),t.onMessage.one(s),e.bot.getExports("ui")){let t=document.head.appendChild(document.createElement("style"));t.innerHTML='.messages-container input[type=number] {\r\n    width: 5em;\r\n    font-size: 0.6rem;\r\n}\r\n\r\n.messages-container {\r\n    border-top: 1px solid #cccccc;\r\n    padding-top: 1em;\r\n}\r\n\r\n.messages-container .box {\r\n    padding: 0.7em;\r\n    padding-bottom: 0;\r\n    margin-bottom: 1em;\r\n}\r\n\r\n.messages-container .columns {\r\n    margin-bottom: 0;\r\n}\r\n\r\n.messages-container .drag::after {\r\n    content: " \\2261";\r\n}\r\n\r\n.messages-container .level-options {\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: center;\r\n}\r\n@media screen and (max-width: 768px) {\r\n    .messages-container .level-options {\r\n        flex-wrap: wrap;\r\n    }\r\n}\r\n\r\n.messages-container summary {\r\n    outline: none;\r\n}\r\n\r\n.is-adding-message {\r\n    position: fixed;\r\n    left: 1em;\r\n    z-index: 10;\r\n}\r\n\r\n.messages-container p {\r\n    margin-right: 0.5em;\r\n}\r\n\r\n/** Copied from https://github.com/bevacqua/dragula/blob/b0e5c4/dist/dragula.css **/\r\n.gu-mirror {\r\n    position: fixed !important;\r\n    margin: 0 !important;\r\n    z-index: 9999 !important;\r\n    opacity: 0.8;\r\n    -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=80)";\r\n    filter: alpha(opacity=80);\r\n}\r\n.gu-hide {\r\n    display: none !important;\r\n}\r\n.gu-unselectable {\r\n    -webkit-user-select: none !important;\r\n    -moz-user-select: none !important;\r\n    -ms-user-select: none !important;\r\n    user-select: none !important;\r\n}\r\n.gu-transit {\r\n    opacity: 0.2;\r\n    -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=20)";\r\n    filter: alpha(opacity=20);\r\n}\r\n';let i=e.bot.getExports("ui");i.addTabGroup("Messages","messages");let s=[new Ve(e),new Ge(e),new Fe(e),new Ke(e)];s.forEach(e=>e.setup()),n=n.concat(...s,{remove:()=>t.remove()},{remove:()=>i.removeTabGroup("messages")})}});ue.registerExtension("console",function(e,t){function n(){e.bot.send(f.value),f.value=""}function i(e,t){if(t.length){let n="player";e.isAdmin&&(n="admin"),e.isMod&&(n="mod"),l.buildTemplate(m,h,[{selector:"li",class:n},{selector:"span:first-child",text:e.name},{selector:"span:last-child",text:": "+t}])}}function s(e){if(e.length){let t=document.createElement("li");t.textContent=e,h.appendChild(t)}}function o(t){e.storage.get("logJoinIps",!0)?g.log(`${t.name} (${t.ip}) joined.`):g.log(`${t.name} joined.`)}function r(e){g.log(e.name+" left")}function a({player:player,message:message}){i(player,message)}function c(t){e.storage.get("logUnparsedMessages",!0)&&s(t)}if(!e.bot.getExports("ui"))throw new Error("This extension should only be loaded in a browser, and must be loaded after the UI is loaded.");const l=e.bot.getExports("ui");let d=document.head.appendChild(document.createElement("style"));d.textContent="#console .mod > span:first-child {\r\n    color: #05f529;\r\n}\r\n\r\n#console .admin > span:first-child {\r\n    color: #2b26bd;\r\n}\r\n\r\n#console .chat {\r\n    margin: 0 1em;\r\n    height: calc(100vh - 52px - 4.25em);\r\n    overflow-y: auto;\r\n}\r\n\r\n#console .chat-control {\r\n    position: fixed;\r\n    bottom: 0;\r\n    width: 100vw;\r\n    background: #fff;\r\n}\r\n\r\n#console .field {\r\n    margin: 1em;\r\n}\r\n";let u=l.addTab("Console");u.innerHTML='<template>\r\n    <li>\r\n        <span>NAME</span>\r\n        <span>: Message</span>\r\n    </li>\r\n</template>\r\n<div id="console">\r\n    <div class="chat">\r\n        <ul></ul>\r\n    </div>\r\n    <div class="chat-control">\r\n        <div class="field has-addons">\r\n            <p class="control is-expanded">\r\n                <input type="text" class="input" />\r\n            </p>\r\n            <p class="control">\r\n                <button class="input button is-primary">SEND</button>\r\n            </p>\r\n        </div>\r\n    </div>\r\n</div>';let h=u.querySelector("ul"),p=h.parentElement,m=u.querySelector("template"),f=u.querySelector("input");f.addEventListener("keyup",e=>{"Enter"==e.key&&n()}),z(f),u.querySelector("button").addEventListener("click",n),new MutationObserver(function(e){let t=h.children.length,n=0;for(let i=t-e.length;i<t;i++)n+=h.children[i].clientHeight;for(p.scrollHeight-p.clientHeight-p.scrollTop==n&&(p.scrollTop=p.scrollHeight);h.children.length>500;)h.children[0].remove()}).observe(h,{childList:!0,subtree:!0});let g={log:e=>i(t.getPlayer("SERVER"),e)};e.exports=g,t.onJoin.sub(o),t.onLeave.sub(r),t.onMessage.sub(a),t.onOther.sub(c),e.remove=function(){l.removeTab(u),d.remove(),t.onJoin.unsub(o),t.onLeave.unsub(r),t.onMessage.unsub(a),t.onOther.unsub(c)}});const Ze=e=>e.reduce((e,t)=>e.concat(t),[]),Qe=`https://gitcdn.xyz/cdn/Blockheads-Messagebot/Extensions/master/extensions.json`;ue.registerExtension("extensions",e=>{function t(t){try{e.bot.addExtension(t),e.storage.with("autoload",[],e=>{e.includes(t)||e.push(t)});const n=a.querySelector(`a[ext_id="${t}"]`);n&&(n.textContent="Remove")}catch(n){r.notify("Error adding extension: "+n);try{e.bot.removeExtension(t,!1)}catch(e){}}}function n(t){try{e.bot.removeExtension(t,!0),e.storage.with("autoload",[],e=>{e.includes(t)&&e.splice(e.indexOf(t),1)});const n=a.querySelector(`a[ext_id="${t}"]`);n&&(n.textContent="Install")}catch(e){r.notify("Error removing extension: "+e)}}function i(t){const n=l.get(t);if(!n)return void console.warn("Could not reload unknown ID:",t);e.bot.removeExtension(t,!1),ue.deregisterExtension(t),c.add(t),document.head.appendChild(document.createElement("script")).src=n.package}function s(e){const n=l.get(e);if(!n)return void console.warn("Could not load unknown ID:",e);if(ue.extensions.includes(e))t(e);else{c.add(e);const t=document.head.appendChild(document.createElement("script"));t.src=n.package}}function o(){for(const e of l.values())r.buildTemplate(a.querySelector("template"),a.querySelector("tbody"),[{selector:"[data-for=title]",text:e.title},{selector:"[data-for=description]",text:e.description},{selector:"[data-for=author]",text:e.user},{selector:"a",ext_id:e.id}])}const r=e.bot.getExports("ui");const a=r.addTab("Extensions");a.innerHTML='<template>\r\n    <tr>\r\n        <td data-for="title"></td>\r\n        <td data-for="actions"><a class="button is-small">Install</a></td>\r\n        <td data-for="description"></td>\r\n        <td data-for="author" class="is-hidden-mobile"></td>\r\n    </tr>\r\n</template>\r\n<div class="container is-fluid">\r\n    <section class="section is-small">\r\n        <h3 class="title is-4">Extensions can increase the functionality of the bot.</h3>\r\n        <span>Interested in creating one?\r\n            <a href="https://github.com/Blockheads-MessageBot/MessageBot/wiki/2.-Development:-Start-Here" target="_blank">Start here.</a>\r\n        </span>\r\n    </section>\r\n    <table class="table is-striped is-fullwidth is-hoverable">\r\n        <thead>\r\n            <tr>\r\n                <th>Name</th>\r\n                <th>Actions</th>\r\n                <th>Description</th>\r\n                <th class="is-hidden-mobile">Author</th>\r\n            </tr>\r\n        </thead>\r\n        <tfoot>\r\n            <tr>\r\n                <th>Name</th>\r\n                <th>Actions</th>\r\n                <th>Description</th>\r\n                <th class="is-hidden-mobile">Author</th>\r\n            </tr>\r\n        </tfoot>\r\n        <tbody></tbody>\r\n    </table>\r\n</div>';a.addEventListener("click",e=>{const t=e.target;if("A"!=t.tagName)return;const i=t.getAttribute("ext_id");if(!i)return;"Install"==t.textContent?s(i):n(i)});e.remove=(()=>{throw new Error("This extension cannot be removed.")});e.exports.reloadExtension=i;const c=new Set;ue.extensionRegistered.sub(n=>{e.storage.get("devMode",!1)?(e.bot.getExports(n)&&e.bot.removeExtension(n,!1),t(n)):c.has(n)&&(c.delete(n),t(n))});const l=new Map;const d=e.storage.get("repos",Qe).split(/\r?\n/).reverse();const u=d.map(e=>fetch(e).then(e=>e.json()));Promise.all(u).then(e=>{Ze(e).filter(V).forEach(e=>{l.set(e.id,e)})}).then(()=>{e.storage.get("autoload",[]).forEach(s);o()}).catch(e=>{console.error(e);r.notify("An extension repo has failed to load.")})});const et=[["messages/announcementDelay",10],["messages/maxResponses",3],["console/logJoinIps",!0],["console/logUnparsedMessages",!0],["messages/regexTriggers",!1],["messages/disableWhitespaceTrimming",!1],["splitMessages",!1],["splitToken","<split>"],["extensions/devMode",!1],["extensions/repos",Qe]];if(ue.registerExtension("settings",function(e){function t(e){let t;try{if(null===(t=JSON.parse(e)))throw new Error("Invalid backup")}catch(e){return void i.notify("Invalid backup code. No action taken.")}localStorage.clear(),Object.keys(t).forEach(e=>{localStorage.setItem(e,t[e])}),location.reload()}const n=e.bot.storage,i=e.bot.getExports("ui"),s=i.addTab("Settings");s.innerHTML='<div class="container">\r\n    <h3 class="title">General Settings</h3>\r\n    <p class="control">\r\n        <label>Minutes between announcements</label>\r\n        <input class="input" type="number" data-target="messages/announcementDelay">\r\n        <br>\r\n    </p>\r\n    <p class="control">\r\n        <label>Maximum trigger responses to a message</label>\r\n        <input class="input" type="number" data-target="messages/maxResponses">\r\n    </p>\r\n    <p class="control">\r\n        <label class="checkbox">\r\n            <input type="checkbox" data-target="console/logJoinIps"> Show joining IPs in console\r\n        </label>\r\n    </p>\r\n    <p class="control">\r\n        <label class="checkbox">\r\n            <input data-target="console/logUnparsedMessages" type="checkbox"> Log unparsed messages\r\n        </label>\r\n    </p>\r\n\r\n    <hr>\r\n\r\n    <h3 class="title">Advanced Settings</h3>\r\n    <div class="message is-warning">\r\n        <div class="message-header">\r\n            <p>Warning</p>\r\n        </div>\r\n        <div class="message-body">\r\n            <p>Changing these options can result in unexpected behavior.\r\n                <a href="https://github.com/Bibliofile/Blockheads-MessageBot/wiki/1.-Advanced-Options/"\r\n                    target="_blank">Read this first</a>\r\n            </p>\r\n        </div>\r\n    </div>\r\n    <p class="control">\r\n        <label class="checkbox">\r\n            <input type="checkbox" data-target="messages/regexTriggers"> Parse triggers as RegEx\r\n        </label>\r\n    </p>\r\n    <p class="control">\r\n        <label class="checkbox">\r\n            <input type="checkbox" data-target="messages/disableWhitespaceTrimming"> Disable whitespace trimming\r\n        </label>\r\n    </p>\r\n    <p class="control">\r\n        <label class="checkbox">\r\n            <input type="checkbox" data-target="splitMessages"> Split messages\r\n        </label>\r\n    </p>\r\n    <label class="label">Split token:</label>\r\n    <p class="control">\r\n        <input class="input" type="text" data-target="splitToken">\r\n    </p>\r\n    <p class="control">\r\n        <label class="checkbox">\r\n            <input type="checkbox" data-target="extensions/devMode"> Developer mode\r\n        </label>\r\n    </p>\r\n    <label class="label">Extension Repsitory URLs (one per line, reload required to apply):</label>\r\n    <p class="control">\r\n        <textarea class="textarea is-fluid" type="text" data-target="extensions/repos"></textarea>\r\n    </p>\r\n\r\n    <hr>\r\n\r\n    <nav class="panel">\r\n        <p class="panel-heading">Backup / Restore</p>\r\n\r\n        <a class="panel-block" data-do="show_backup">Show Backup</a>\r\n        <a class="panel-block" data-do="download_backup">Download Backup</a>\r\n        <a class="panel-block" data-do="import_backup">Import Backup</a>\r\n        <a class="panel-block" data-do="upload_backup">Upload Backup</a>\r\n    </nav>\r\n\r\n    <br>\r\n</div>';for(const[e,t]of et){const i=s.querySelector(`[data-target="${e}"]`);"boolean"==typeof t?i.checked=n.get(e,t):i.value=String(n.get(e,t))}s.addEventListener("change",()=>{for(const[e,t]of et){const i=s.querySelector(`[data-target="${e}"]`);"boolean"==typeof t?n.set(e,i.checked):"number"==typeof t?n.set(e,+i.value):n.set(e,i.value)}}),s.querySelector("[data-do=show_backup]").addEventListener("click",()=>{const e=JSON.stringify(localStorage).replace(/</g,"&lt;");i.alert(`<p>Copy this to a safe place.</p><textarea class="textarea">${e}</textarea>`)}),s.querySelector("[data-do=import_backup]").addEventListener("click",()=>{i.prompt("Enter your backup code, this will reload the page:",e=>{e&&t(e)})}),s.querySelector("[data-do=download_backup]").addEventListener("click",()=>{const e=JSON.stringify(localStorage,void 0,4);const t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e));t.setAttribute("download","bot_backup.txt");t.style.display="none";document.body.appendChild(t);t.click();document.body.removeChild(t)}),s.querySelector("[data-do=upload_backup]").addEventListener("click",()=>{if(!(File&&FileReader&&FileList&&Blob))return void i.notify(`It looks like your browser doesn't support this.`);const e=document.createElement("input");e.type="file";e.addEventListener("change",()=>{if(!e.files||"text/plain"!=e.files[0].type)return void i.notify("Upload a text file.");const n=new FileReader;n.addEventListener("load",()=>{t(n.result)});n.readAsText(e.files[0])});e.click()}),e.remove=function(){i.removeTab(s)}}),window["@bhmb/bot"])throw new Error("Bot already loaded.");window["@bhmb/bot"]={MessageBot:ue,SimpleEvent:K};const tt=window.worldId.toString();if("portal.theblockheads.net"!=location.hostname&&confirm("You are not on the portal, go there now?")&&location.assign("http://portal.theblockheads.net"),!tt)throw alert("You must be on a world page to start the bot"),new Error("Bad page");window.pollChat=(()=>{}),ue.dependencies={Api:ge,getWorlds:u,fetch:fetch};const nt={name:document.querySelector("#title").textContent,id:tt};!function(){n(this,void 0,void 0,function*(){const e=new he(new ve(`/${tt}`),nt);e.addExtension("ui"),e.addExtension("console"),document.querySelector(".nav-item").click(),e.addExtension("messages"),e.addExtension("settings"),e.addExtension("extensions");const t=e=>{e.key==="load_indicator"+tt&&"1"===e.newValue&&(localStorage.setItem("already_loaded"+tt,"1"),localStorage.setItem("load_indicator"+tt,"0"))},n=t=>{t.key==="already_loaded"+tt&&"1"===t.newValue&&(localStorage.setItem("already_loaded"+tt,"0"),e.getExports("ui").alert("Warning: The bot is already loaded in another tab. If you leave this tab open, your storage may be overwritten and messages may be sent twice."))};addEventListener("storage",t),addEventListener("storage",n),localStorage.setItem("load_indicator"+tt,"1"),localStorage.setItem("load_indicator"+tt,"0"),e.start(),yield e.world.start(),yield e.world.getLists(!0)})}()}(crypto);
//# sourceMappingURL=bundle.js.map
